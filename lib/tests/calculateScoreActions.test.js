"use strict";

var _RepositoryLocalPure = require("../repositories/RepositoryLocalPure");

var _calculateScoreActions = require("../calculateScoreActions");

var _calculateScore = require("../calculateScore");

var _Claim = require("../dataModels/Claim");

var _Action = require("../dataModels/Action");

var _ClaimEdge = require("../dataModels/ClaimEdge");

var _Score = require("../dataModels/Score");

//import { RepositoryLocalReactive } from "../repositories/RepositoryLocalReactive";
const u = undefined;
test('add a new scoretree', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure(); // Add a new claim and set it as a score tree top

  const newScore = new _Score.Score("testClaim", "testClaim");
  const result = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("", "testClaim"), undefined, "add_claim", "testClaim"), new _Action.Action(newScore, undefined, "add_score", newScore.id)],
    repository: repository,
    calculator: _calculateScore.calculateScore
  });
  expect(repository.rsData.scoreIdsBySourceId["testClaim"].length).toEqual(1);
});
test('Add a child that does not change the top score', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure();
  const temp = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("", "testClaim"), undefined, "add_claim"), new _Action.Action(new _Score.Score("testClaim", "testClaim", u, u, u, u, u, u, u, "newScore"), undefined, "add_score"), new _Action.Action(new _Claim.Claim("", "ChildClaim1"), undefined, "add_claim")],
    repository: repository
  });
  const result = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim1"), undefined, "add_claimEdge")],
    repository: repository
  });
  expect(result).toMatchObject([{
    "newData": {
      "sourceClaimId": "ChildClaim1",
      "reversible": false,
      "pro": true,
      "affects": "confidence",
      "confidence": 1,
      "relevance": 1,
      "parentScoreId": "newScore" //"dataId": "Ya3ZeuTmGUZq"

    },
    "oldData": undefined,
    "type": "add_score" //"dataId": "Ya3ZeuTmGUZq"

  }]);
});
test('Changing a child pro value should change the top score', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure();
  const temp = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("", "testClaim"), u, "add_claim"), new _Action.Action(new _Score.Score("testClaim", "testClaim", u, u, u, u, u, u, u, "newScore"), u, "add_score"), new _Action.Action(new _Claim.Claim("", "ChildClaim1"), u, "add_claim"), new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim1", u, true, "ChildClaim1Edge"), u, "add_claimEdge")],
    repository: repository
  });
  const result = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim1", u, false, "ChildClaim1Edge"), u, "modify_claimEdge")],
    repository: repository
  });
  expect(result).toMatchObject([{
    "newData": {
      "sourceClaimId": "testClaim",
      "parentScoreId": undefined,
      "reversible": false,
      "pro": true,
      "affects": "confidence",
      "confidence": 0,
      "relevance": 1
    },
    "oldData": undefined,
    "type": "modify_score"
  }]);
});
test('Add a child that reverses the top score', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure();
  const temp = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("", "testClaim"), undefined, "add_claim"), new _Action.Action(new _Score.Score("testClaim", "testClaim", u, u, u, u, u, u, u, "newScore"), undefined, "add_score"), new _Action.Action(new _Claim.Claim("", "ChildClaim1"), undefined, "add_claim")],
    repository: repository
  });
  const result = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim1", undefined, false, "ChildClaim1Edge"), undefined, "add_claimEdge")],
    repository: repository,
    calculator: _calculateScore.calculateScore
  });
  expect(result).toMatchObject([{
    "newData": {
      "sourceClaimId": "ChildClaim1",
      "reversible": false,
      "pro": false,
      "affects": "confidence",
      "confidence": 1,
      "relevance": 1,
      "parentScoreId": "newScore" //"dataId": "Ya3ZeuTmGUZq"

    },
    "oldData": undefined,
    "type": "add_score" //"dataId": "Ya3ZeuTmGUZq"

  }, {
    "newData": {
      "sourceClaimId": "testClaim",
      "parentScoreId": undefined,
      "reversible": false,
      "pro": true,
      "affects": "confidence",
      "confidence": 0,
      "relevance": 1 //"id": "Y9ZapFMMg0Bf"

    },
    "oldData": undefined,
    "type": "modify_score" //"dataId": "Ya3ZeuTmGUZq"

  }]);
});
test('Adding a grandchild score Reverses Scores 2 levels', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure();
  const temp = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("", "testClaim"), undefined, "add_claim"), new _Action.Action(new _Score.Score("testClaim", "testClaim", u, u, u, u, u, 0, u, "newScore"), undefined, "add_score"), new _Action.Action(new _Claim.Claim("", "ChildClaim1"), undefined, "add_claim"), new _Action.Action(new _Claim.Claim("", "ChildClaim2"), undefined, "add_claim"), new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim1", undefined, false, "ChildClaim1Edge"), undefined, "add_claimEdge"), new _Action.Action(new _ClaimEdge.ClaimEdge("testClaim", "ChildClaim2", undefined, true, "ChildClaim2Edge"), undefined, "add_claimEdge"), new _Action.Action(new _Claim.Claim("", "grandChild1"), undefined, "add_claim")],
    repository: repository
  });
  const result = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _ClaimEdge.ClaimEdge("ChildClaim1", "grandChild1", undefined, false, "GrandChildClaim1Edge"), undefined, "add_claimEdge")],
    repository: repository,
    calculator: _calculateScore.calculateScore
  });
  expect(result).toMatchObject([{
    "newData": {
      "sourceClaimId": "grandChild1",
      "topScoreId": "newScore",
      "sourceEdgeId": "GrandChildClaim1Edge",
      "reversible": false,
      "pro": false,
      "affects": "confidence",
      "confidence": 1,
      "relevance": 1
    },
    "type": "add_score"
  }, {
    "newData": {
      "sourceClaimId": "ChildClaim1",
      "topScoreId": "newScore",
      "parentScoreId": "newScore",
      "sourceEdgeId": "ChildClaim1Edge",
      "reversible": false,
      "pro": false,
      "affects": "confidence",
      "confidence": 0,
      "relevance": 1
    },
    "type": "modify_score"
  }, {
    "newData": {
      "sourceClaimId": "testClaim",
      "topScoreId": "testClaim",
      "reversible": false,
      "pro": true,
      "affects": "confidence",
      "confidence": 1,
      "relevance": 1,
      "id": "newScore"
    },
    "type": "modify_score",
    "dataId": "newScore"
  }]);
});
test('Complex Test', async () => {
  const repository = new _RepositoryLocalPure.RepositoryLocalPure();
  const changedScores = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("Top Claim", "topClaim"), u, "add_claim"), new _Action.Action(new _Claim.Claim("Child Claim 1", "ChildClaim1"), u, "add_claim"), new _Action.Action(new _Claim.Claim("Child Claim 2", "ChildClaim2"), u, "add_claim"), new _Action.Action(new _Claim.Claim("Grandchild Claim 1", "grandChild1"), u, "add_claim"), new _Action.Action(new _ClaimEdge.ClaimEdge("topClaim", "ChildClaim1", u, false, "ChildClaim1Edge"), u, "add_claimEdge"), new _Action.Action(new _ClaimEdge.ClaimEdge("topClaim", "ChildClaim2", u, true, "ChildClaim2Edge"), u, "add_claimEdge"), new _Action.Action(new _ClaimEdge.ClaimEdge("ChildClaim1", "grandChild1", u, false, "GrandChildClaim1Edge"), u, "add_claimEdge"), new _Action.Action(new _Score.Score("topClaim", "topClaim", u, u, u, u, u, 0, u, "newScore"), u, "add_score")],
    repository: repository
  });
  await repository.notify(changedScores);
  expect(repository.rsData.scores["newScore"].confidence).toEqual(1);
  expect(repository.rsData.scoreIdsBySourceId["topClaim"].length).toEqual(1); //TODO: Do i want to check all indexes for duplicate indexed items?
  //TODO: either put in expect or delete items below - Weird Dupe Example

  const changedScores2 = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _ClaimEdge.ClaimEdge("topClaim", "ChildClaim1", u, false, "ChildClaim1Edge"), u, "modify_claimEdge")],
    repository: repository
  });
  await repository.notify(changedScores2);
  const changedScores3 = await (0, _calculateScoreActions.calculateScoreActions)({
    actions: [new _Action.Action(new _Claim.Claim("Grandchild Claim 2", "grandChild2"), u, "add_claim"), new _Action.Action(new _ClaimEdge.ClaimEdge("ChildClaim1", "grandChild2", u, false, "GrandChildClaim2Edge"), u, "add_claimEdge")],
    repository: repository
  });
  await repository.notify(changedScores3);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0cy9jYWxjdWxhdGVTY29yZUFjdGlvbnMudGVzdC50cyJdLCJuYW1lcyI6WyJ1IiwidW5kZWZpbmVkIiwidGVzdCIsInJlcG9zaXRvcnkiLCJSZXBvc2l0b3J5TG9jYWxQdXJlIiwibmV3U2NvcmUiLCJTY29yZSIsInJlc3VsdCIsImFjdGlvbnMiLCJBY3Rpb24iLCJDbGFpbSIsImlkIiwiY2FsY3VsYXRvciIsImNhbGN1bGF0ZVNjb3JlIiwiZXhwZWN0IiwicnNEYXRhIiwic2NvcmVJZHNCeVNvdXJjZUlkIiwibGVuZ3RoIiwidG9FcXVhbCIsInRlbXAiLCJDbGFpbUVkZ2UiLCJ0b01hdGNoT2JqZWN0IiwiY2hhbmdlZFNjb3JlcyIsIm5vdGlmeSIsInNjb3JlcyIsImNvbmZpZGVuY2UiLCJjaGFuZ2VkU2NvcmVzMiIsImNoYW5nZWRTY29yZXMzIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBO0FBRUEsTUFBTUEsQ0FBQyxHQUFHQyxTQUFWO0FBRUFDLElBQUksQ0FBQyxxQkFBRCxFQUF3QixZQUFZO0FBQ3RDLFFBQU1DLFVBQVUsR0FBRyxJQUFJQyx3Q0FBSixFQUFuQixDQURzQyxDQUV0Qzs7QUFDQSxRQUFNQyxRQUFRLEdBQUcsSUFBSUMsWUFBSixDQUFVLFdBQVYsRUFBdUIsV0FBdkIsQ0FBakI7QUFDQSxRQUFNQyxNQUFNLEdBQUcsTUFBTSxrREFBc0I7QUFDekNDLElBQUFBLE9BQU8sRUFBRSxDQUNQLElBQUlDLGNBQUosQ0FBVyxJQUFJQyxZQUFKLENBQVUsRUFBVixFQUFjLFdBQWQsQ0FBWCxFQUF1Q1QsU0FBdkMsRUFBa0QsV0FBbEQsRUFBK0QsV0FBL0QsQ0FETyxFQUVQLElBQUlRLGNBQUosQ0FBV0osUUFBWCxFQUFxQkosU0FBckIsRUFBZ0MsV0FBaEMsRUFBNkNJLFFBQVEsQ0FBQ00sRUFBdEQsQ0FGTyxDQURnQztBQUt6Q1IsSUFBQUEsVUFBVSxF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SUFBSUMsY0FBSixDQUFXLElBQUlDLFlBQUosQ0FBVSxvQkFBVixFQUFnQyxhQUFoQyxDQUFYLEVBQTJEVixDQUEzRCxFQUE4RCxXQUE5RCxDQURPLEVBRVAsSUFBSVMsY0FBSixDQUFXLElBQUlXLG9CQUFKLENBQWMsYUFBZCxFQUE2QixhQUE3QixFQUE0Q3BCLENBQTVDLEVBQStDLEtBQS9DLEVBQXNELHNCQUF0RCxDQUFYLEVBQTBGQSxDQUExRixFQUE2RixlQUE3RixDQUZPLENBRHdDO0FBS2pERyxJQUFBQSxVQUFVLEVBQUVBO0FBTHFDLEdBQXRCLENBQTdCO0FBT0EsUUFBTUEsVUFBVSxDQUFDb0IsTUFBWCxDQUFrQkksY0FBbEIsQ0FBTjtBQUNELENBckNHLENBQUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXBvc2l0b3J5TG9jYWxQdXJlIH0gZnJvbSBcIi4uL3JlcG9zaXRvcmllcy9SZXBvc2l0b3J5TG9jYWxQdXJlXCI7XHJcbmltcG9ydCB7IGNhbGN1bGF0ZVNjb3JlQWN0aW9ucyB9IGZyb20gXCIuLi9jYWxjdWxhdGVTY29yZUFjdGlvbnNcIjtcclxuaW1wb3J0IHsgY2FsY3VsYXRlU2NvcmUgfSBmcm9tIFwiLi4vY2FsY3VsYXRlU2NvcmVcIjtcclxuaW1wb3J0IHsgQ2xhaW0gfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9DbGFpbVwiO1xyXG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9BY3Rpb25cIjtcclxuaW1wb3J0IHsgQ2xhaW1FZGdlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1FZGdlXCI7XHJcbmltcG9ydCB7IFNjb3JlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvU2NvcmVcIjtcclxuLy9pbXBvcnQgeyBSZXBvc2l0b3J5TG9jYWxSZWFjdGl2ZSB9IGZyb20gXCIuLi9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmVcIjtcclxuXHJcbmNvbnN0IHUgPSB1bmRlZmluZWQ7XHJcblxyXG50ZXN0KCdhZGQgYSBuZXcgc2NvcmV0cmVlJywgYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IHJlcG9zaXRvcnkgPSBuZXcgUmVwb3NpdG9yeUxvY2FsUHVyZSgpO1xyXG4gIC8vIEFkZCBhIG5ldyBjbGFpbSBhbmQgc2V0IGl0IGFzIGEgc2NvcmUgdHJlZSB0b3BcclxuICBjb25zdCBuZXdTY29yZSA9IG5ldyBTY29yZShcInRlc3RDbGFpbVwiLCBcInRlc3RDbGFpbVwiKTtcclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcInRlc3RDbGFpbVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbVwiLCBcInRlc3RDbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXdTY29yZSwgdW5kZWZpbmVkLCBcImFkZF9zY29yZVwiLCBuZXdTY29yZS5pZClcclxuICAgIF0sXHJcbiAgICByZXBvc2l0b3J5OiByZXBvc2l0b3J5LFxyXG4gICAgY2FsY3VsYXRvcjogY2FsY3VsYXRlU2NvcmVcclxuICB9KVxyXG5cclxuICBleHBlY3QocmVwb3NpdG9yeS5yc0RhdGEuc2NvcmVJZHNCeVNvdXJjZUlkW1widGVzdENsYWltXCJdLmxlbmd0aCkudG9FcXVhbCgxKVxyXG59KTtcclxuXHJcbnRlc3QoJ0FkZCBhIGNoaWxkIHRoYXQgZG9lcyBub3QgY2hhbmdlIHRoZSB0b3Agc2NvcmUnLCBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgcmVwb3NpdG9yeSA9IG5ldyBSZXBvc2l0b3J5TG9jYWxQdXJlKCk7XHJcbiAgY29uc3QgdGVtcCA9IGF3YWl0IGNhbGN1bGF0ZVNjb3JlQWN0aW9ucyh7XHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltKFwiXCIsIFwidGVzdENsYWltXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBTY29yZShcInRlc3RDbGFpbVwiLCBcInRlc3RDbGFpbVwiLCB1LCB1LCB1LCB1LCB1LCB1LCB1LCBcIm5ld1Njb3JlXCIpLCB1bmRlZmluZWQsIFwiYWRkX3Njb3JlXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcIkNoaWxkQ2xhaW0xXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltXCIpLFxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnlcclxuICB9KVxyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbUVkZ2UoXCJ0ZXN0Q2xhaW1cIiwgXCJDaGlsZENsYWltMVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbUVkZ2VcIilcclxuICAgIF0sXHJcbiAgICByZXBvc2l0b3J5OiByZXBvc2l0b3J5XHJcbiAgfSlcclxuXHJcbiAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaE9iamVjdChcclxuICAgIFtcclxuICAgICAge1xyXG4gICAgICAgIFwibmV3RGF0YVwiOlxyXG4gICAgICAgIHtcclxuICAgICAgICAgIFwic291cmNlQ2xhaW1JZFwiOiBcIkNoaWxkQ2xhaW0xXCIsXHJcbiAgICAgICAgICBcInJldmVyc2libGVcIjogZmFsc2UsXHJcbiAgICAgICAgICBcInByb1wiOiB0cnVlLFxyXG4gICAgICAgICAgXCJhZmZlY3RzXCI6IFwiY29uZmlkZW5jZVwiLFxyXG4gICAgICAgICAgXCJjb25maWRlbmNlXCI6IDEsXHJcbiAgICAgICAgICBcInJlbGV2YW5jZVwiOiAxLFxyXG4gICAgICAgICAgXCJwYXJlbnRTY29yZUlkXCI6IFwibmV3U2NvcmVcIlxyXG4gICAgICAgICAgLy9cImRhdGFJZFwiOiBcIllhM1pldVRtR1VacVwiXHJcbiAgICAgICAgfSwgXCJvbGREYXRhXCI6IHVuZGVmaW5lZCxcclxuICAgICAgICBcInR5cGVcIjogXCJhZGRfc2NvcmVcIixcclxuICAgICAgICAvL1wiZGF0YUlkXCI6IFwiWWEzWmV1VG1HVVpxXCJcclxuICAgICAgfVxyXG4gICAgXVxyXG4gIClcclxuXHJcbn0pO1xyXG5cclxudGVzdCgnQ2hhbmdpbmcgYSBjaGlsZCBwcm8gdmFsdWUgc2hvdWxkIGNoYW5nZSB0aGUgdG9wIHNjb3JlJywgYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IHJlcG9zaXRvcnkgPSBuZXcgUmVwb3NpdG9yeUxvY2FsUHVyZSgpO1xyXG4gIGNvbnN0IHRlbXAgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcInRlc3RDbGFpbVwiKSwgdSwgXCJhZGRfY2xhaW1cIiksXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IFNjb3JlKFwidGVzdENsYWltXCIsIFwidGVzdENsYWltXCIsIHUsIHUsIHUsIHUsIHUsIHUsIHUsIFwibmV3U2NvcmVcIiksIHUsIFwiYWRkX3Njb3JlXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcIkNoaWxkQ2xhaW0xXCIpLCB1LCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwidGVzdENsYWltXCIsIFwiQ2hpbGRDbGFpbTFcIiwgdSwgdHJ1ZSwgXCJDaGlsZENsYWltMUVkZ2VcIiksIHUsIFwiYWRkX2NsYWltRWRnZVwiKVxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnlcclxuICB9KVxyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbUVkZ2UoXCJ0ZXN0Q2xhaW1cIiwgXCJDaGlsZENsYWltMVwiLCB1LCBmYWxzZSwgXCJDaGlsZENsYWltMUVkZ2VcIiksIHUsIFwibW9kaWZ5X2NsYWltRWRnZVwiKVxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnlcclxuICB9KVxyXG5cclxuICBleHBlY3QocmVzdWx0KS50b01hdGNoT2JqZWN0KFxyXG4gICAgW1xyXG4gICAgICB7XHJcbiAgICAgICAgXCJuZXdEYXRhXCI6XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgXCJzb3VyY2VDbGFpbUlkXCI6IFwidGVzdENsYWltXCIsXHJcbiAgICAgICAgICBcInBhcmVudFNjb3JlSWRcIjogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgXCJyZXZlcnNpYmxlXCI6IGZhbHNlLFxyXG4gICAgICAgICAgXCJwcm9cIjogdHJ1ZSxcclxuICAgICAgICAgIFwiYWZmZWN0c1wiOiBcImNvbmZpZGVuY2VcIixcclxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiAwLFxyXG4gICAgICAgICAgXCJyZWxldmFuY2VcIjogMSxcclxuICAgICAgICB9LCBcIm9sZERhdGFcIjogdW5kZWZpbmVkLFxyXG4gICAgICAgIFwidHlwZVwiOiBcIm1vZGlmeV9zY29yZVwiLFxyXG4gICAgICB9XHJcbiAgICBdKVxyXG5cclxufSk7XHJcblxyXG50ZXN0KCdBZGQgYSBjaGlsZCB0aGF0IHJldmVyc2VzIHRoZSB0b3Agc2NvcmUnLCBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgcmVwb3NpdG9yeSA9IG5ldyBSZXBvc2l0b3J5TG9jYWxQdXJlKCk7XHJcbiAgY29uc3QgdGVtcCA9IGF3YWl0IGNhbGN1bGF0ZVNjb3JlQWN0aW9ucyh7XHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltKFwiXCIsIFwidGVzdENsYWltXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBTY29yZShcInRlc3RDbGFpbVwiLCBcInRlc3RDbGFpbVwiLCB1LCB1LCB1LCB1LCB1LCB1LCB1LCBcIm5ld1Njb3JlXCIpLCB1bmRlZmluZWQsIFwiYWRkX3Njb3JlXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcIkNoaWxkQ2xhaW0xXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltXCIpLFxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnlcclxuICB9KVxyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbUVkZ2UoXCJ0ZXN0Q2xhaW1cIiwgXCJDaGlsZENsYWltMVwiLCB1bmRlZmluZWQsIGZhbHNlLCBcIkNoaWxkQ2xhaW0xRWRnZVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbUVkZ2VcIilcclxuICAgIF0sXHJcbiAgICByZXBvc2l0b3J5OiByZXBvc2l0b3J5LFxyXG4gICAgY2FsY3VsYXRvcjogY2FsY3VsYXRlU2NvcmVcclxuICB9KVxyXG5cclxuICBleHBlY3QocmVzdWx0KS50b01hdGNoT2JqZWN0KFxyXG4gICAgW1xyXG4gICAgICB7XHJcbiAgICAgICAgXCJuZXdEYXRhXCI6XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgXCJzb3VyY2VDbGFpbUlkXCI6IFwiQ2hpbGRDbGFpbTFcIixcclxuICAgICAgICAgIFwicmV2ZXJzaWJsZVwiOiBmYWxzZSxcclxuICAgICAgICAgIFwicHJvXCI6IGZhbHNlLFxyXG4gICAgICAgICAgXCJhZmZlY3RzXCI6IFwiY29uZmlkZW5jZVwiLFxyXG4gICAgICAgICAgXCJjb25maWRlbmNlXCI6IDEsXHJcbiAgICAgICAgICBcInJlbGV2YW5jZVwiOiAxLFxyXG4gICAgICAgICAgXCJwYXJlbnRTY29yZUlkXCI6IFwibmV3U2NvcmVcIlxyXG4gICAgICAgICAgLy9cImRhdGFJZFwiOiBcIllhM1pldVRtR1VacVwiXHJcbiAgICAgICAgfSwgXCJvbGREYXRhXCI6IHVuZGVmaW5lZCxcclxuICAgICAgICBcInR5cGVcIjogXCJhZGRfc2NvcmVcIixcclxuICAgICAgICAvL1wiZGF0YUlkXCI6IFwiWWEzWmV1VG1HVVpxXCJcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIFwibmV3RGF0YVwiOlxyXG4gICAgICAgIHtcclxuICAgICAgICAgIFwic291cmNlQ2xhaW1JZFwiOiBcInRlc3RDbGFpbVwiLFxyXG4gICAgICAgICAgXCJwYXJlbnRTY29yZUlkXCI6IHVuZGVmaW5lZCxcclxuICAgICAgICAgIFwicmV2ZXJzaWJsZVwiOiBmYWxzZSxcclxuICAgICAgICAgIFwicHJvXCI6IHRydWUsXHJcbiAgICAgICAgICBcImFmZmVjdHNcIjogXCJjb25maWRlbmNlXCIsXHJcbiAgICAgICAgICBcImNvbmZpZGVuY2VcIjogMCxcclxuICAgICAgICAgIFwicmVsZXZhbmNlXCI6IDEsXHJcbiAgICAgICAgICAvL1wiaWRcIjogXCJZOVphcEZNTWcwQmZcIlxyXG4gICAgICAgIH0sIFwib2xkRGF0YVwiOiB1bmRlZmluZWQsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwibW9kaWZ5X3Njb3JlXCIsXHJcbiAgICAgICAgLy9cImRhdGFJZFwiOiBcIllhM1pldVRtR1VacVwiXHJcbiAgICAgIH1cclxuICAgIF1cclxuICApXHJcblxyXG59KTtcclxuXHJcbnRlc3QoJ0FkZGluZyBhIGdyYW5kY2hpbGQgc2NvcmUgUmV2ZXJzZXMgU2NvcmVzIDIgbGV2ZWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IHJlcG9zaXRvcnkgPSBuZXcgUmVwb3NpdG9yeUxvY2FsUHVyZSgpO1xyXG4gIGNvbnN0IHRlbXAgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIlwiLCBcInRlc3RDbGFpbVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgU2NvcmUoXCJ0ZXN0Q2xhaW1cIiwgXCJ0ZXN0Q2xhaW1cIiwgdSwgdSwgdSwgdSwgdSwgMCwgdSwgXCJuZXdTY29yZVwiKSwgdW5kZWZpbmVkLCBcImFkZF9zY29yZVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW0oXCJcIiwgXCJDaGlsZENsYWltMVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW0oXCJcIiwgXCJDaGlsZENsYWltMlwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwidGVzdENsYWltXCIsIFwiQ2hpbGRDbGFpbTFcIiwgdW5kZWZpbmVkLCBmYWxzZSwgXCJDaGlsZENsYWltMUVkZ2VcIiksIHVuZGVmaW5lZCwgXCJhZGRfY2xhaW1FZGdlXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbUVkZ2UoXCJ0ZXN0Q2xhaW1cIiwgXCJDaGlsZENsYWltMlwiLCB1bmRlZmluZWQsIHRydWUsIFwiQ2hpbGRDbGFpbTJFZGdlXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltRWRnZVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW0oXCJcIiwgXCJncmFuZENoaWxkMVwiKSwgdW5kZWZpbmVkLCBcImFkZF9jbGFpbVwiKSxcclxuICAgIF0sXHJcbiAgICByZXBvc2l0b3J5OiByZXBvc2l0b3J5XHJcbiAgfSlcclxuXHJcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FsY3VsYXRlU2NvcmVBY3Rpb25zKHtcclxuICAgIGFjdGlvbnM6IFtcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwiQ2hpbGRDbGFpbTFcIiwgXCJncmFuZENoaWxkMVwiLCB1bmRlZmluZWQsIGZhbHNlLCBcIkdyYW5kQ2hpbGRDbGFpbTFFZGdlXCIpLCB1bmRlZmluZWQsIFwiYWRkX2NsYWltRWRnZVwiKVxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnksXHJcbiAgICBjYWxjdWxhdG9yOiBjYWxjdWxhdGVTY29yZVxyXG4gIH0pXHJcblxyXG4gIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2hPYmplY3QoXHJcbiAgICBbXHJcbiAgICAgIHtcclxuICAgICAgICBcIm5ld0RhdGFcIjoge1xyXG4gICAgICAgICAgXCJzb3VyY2VDbGFpbUlkXCI6IFwiZ3JhbmRDaGlsZDFcIixcclxuICAgICAgICAgIFwidG9wU2NvcmVJZFwiOiBcIm5ld1Njb3JlXCIsXHJcbiAgICAgICAgICBcInNvdXJjZUVkZ2VJZFwiOiBcIkdyYW5kQ2hpbGRDbGFpbTFFZGdlXCIsXHJcbiAgICAgICAgICBcInJldmVyc2libGVcIjogZmFsc2UsXHJcbiAgICAgICAgICBcInByb1wiOiBmYWxzZSxcclxuICAgICAgICAgIFwiYWZmZWN0c1wiOiBcImNvbmZpZGVuY2VcIixcclxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiAxLFxyXG4gICAgICAgICAgXCJyZWxldmFuY2VcIjogMSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwidHlwZVwiOiBcImFkZF9zY29yZVwiLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgXCJuZXdEYXRhXCI6IHtcclxuICAgICAgICAgIFwic291cmNlQ2xhaW1JZFwiOiBcIkNoaWxkQ2xhaW0xXCIsXHJcbiAgICAgICAgICBcInRvcFNjb3JlSWRcIjogXCJuZXdTY29yZVwiLFxyXG4gICAgICAgICAgXCJwYXJlbnRTY29yZUlkXCI6IFwibmV3U2NvcmVcIixcclxuICAgICAgICAgIFwic291cmNlRWRnZUlkXCI6IFwiQ2hpbGRDbGFpbTFFZGdlXCIsXHJcbiAgICAgICAgICBcInJldmVyc2libGVcIjogZmFsc2UsXHJcbiAgICAgICAgICBcInByb1wiOiBmYWxzZSxcclxuICAgICAgICAgIFwiYWZmZWN0c1wiOiBcImNvbmZpZGVuY2VcIixcclxuICAgICAgICAgIFwiY29uZmlkZW5jZVwiOiAwLFxyXG4gICAgICAgICAgXCJyZWxldmFuY2VcIjogMSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwidHlwZVwiOiBcIm1vZGlmeV9zY29yZVwiLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgXCJuZXdEYXRhXCI6IHtcclxuICAgICAgICAgIFwic291cmNlQ2xhaW1JZFwiOiBcInRlc3RDbGFpbVwiLFxyXG4gICAgICAgICAgXCJ0b3BTY29yZUlkXCI6IFwidGVzdENsYWltXCIsXHJcbiAgICAgICAgICBcInJldmVyc2libGVcIjogZmFsc2UsXHJcbiAgICAgICAgICBcInByb1wiOiB0cnVlLFxyXG4gICAgICAgICAgXCJhZmZlY3RzXCI6IFwiY29uZmlkZW5jZVwiLFxyXG4gICAgICAgICAgXCJjb25maWRlbmNlXCI6IDEsXHJcbiAgICAgICAgICBcInJlbGV2YW5jZVwiOiAxLFxyXG4gICAgICAgICAgXCJpZFwiOiBcIm5ld1Njb3JlXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwidHlwZVwiOiBcIm1vZGlmeV9zY29yZVwiLFxyXG4gICAgICAgIFwiZGF0YUlkXCI6IFwibmV3U2NvcmVcIlxyXG4gICAgICB9XHJcbiAgICBdXHJcbiAgKVxyXG5cclxufSk7XHJcblxyXG50ZXN0KCdDb21wbGV4IFRlc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgcmVwb3NpdG9yeSA9IG5ldyBSZXBvc2l0b3J5TG9jYWxQdXJlKCk7XHJcbiAgY29uc3QgY2hhbmdlZFNjb3JlcyA9IGF3YWl0IGNhbGN1bGF0ZVNjb3JlQWN0aW9ucyh7XHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltKFwiVG9wIENsYWltXCIsIFwidG9wQ2xhaW1cIiksIHUsIFwiYWRkX2NsYWltXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIkNoaWxkIENsYWltIDFcIiwgXCJDaGlsZENsYWltMVwiKSwgdSwgXCJhZGRfY2xhaW1cIiksXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltKFwiQ2hpbGQgQ2xhaW0gMlwiLCBcIkNoaWxkQ2xhaW0yXCIpLCB1LCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW0oXCJHcmFuZGNoaWxkIENsYWltIDFcIiwgXCJncmFuZENoaWxkMVwiKSwgdSwgXCJhZGRfY2xhaW1cIiksXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltRWRnZShcInRvcENsYWltXCIsIFwiQ2hpbGRDbGFpbTFcIiwgdSwgZmFsc2UsIFwiQ2hpbGRDbGFpbTFFZGdlXCIpLCB1LCBcImFkZF9jbGFpbUVkZ2VcIiksXHJcbiAgICAgIG5ldyBBY3Rpb24obmV3IENsYWltRWRnZShcInRvcENsYWltXCIsIFwiQ2hpbGRDbGFpbTJcIiwgdSwgdHJ1ZSwgXCJDaGlsZENsYWltMkVkZ2VcIiksIHUsIFwiYWRkX2NsYWltRWRnZVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwiQ2hpbGRDbGFpbTFcIiwgXCJncmFuZENoaWxkMVwiLCB1LCBmYWxzZSwgXCJHcmFuZENoaWxkQ2xhaW0xRWRnZVwiKSwgdSwgXCJhZGRfY2xhaW1FZGdlXCIpLFxyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBTY29yZShcInRvcENsYWltXCIsIFwidG9wQ2xhaW1cIiwgdSwgdSwgdSwgdSwgdSwgMCwgdSwgXCJuZXdTY29yZVwiKSwgdSwgXCJhZGRfc2NvcmVcIiksXHJcbiAgICBdLFxyXG4gICAgcmVwb3NpdG9yeTogcmVwb3NpdG9yeVxyXG4gIH0pXHJcblxyXG4gIGF3YWl0IHJlcG9zaXRvcnkubm90aWZ5KGNoYW5nZWRTY29yZXMpO1xyXG4gIGV4cGVjdChyZXBvc2l0b3J5LnJzRGF0YS5zY29yZXNbXCJuZXdTY29yZVwiXS5jb25maWRlbmNlKS50b0VxdWFsKDEpO1xyXG4gIGV4cGVjdChyZXBvc2l0b3J5LnJzRGF0YS5zY29yZUlkc0J5U291cmNlSWRbXCJ0b3BDbGFpbVwiXS5sZW5ndGgpLnRvRXF1YWwoMSk7XHJcbiAgLy9UT0RPOiBEbyBpIHdhbnQgdG8gY2hlY2sgYWxsIGluZGV4ZXMgZm9yIGR1cGxpY2F0ZSBpbmRleGVkIGl0ZW1zP1xyXG5cclxuICAvL1RPRE86IGVpdGhlciBwdXQgaW4gZXhwZWN0IG9yIGRlbGV0ZSBpdGVtcyBiZWxvdyAtIFdlaXJkIER1cGUgRXhhbXBsZVxyXG4gIGNvbnN0IGNoYW5nZWRTY29yZXMyID0gYXdhaXQgY2FsY3VsYXRlU2NvcmVBY3Rpb25zKHtcclxuICAgIGFjdGlvbnM6IFtcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwidG9wQ2xhaW1cIiwgXCJDaGlsZENsYWltMVwiLCB1LCBmYWxzZSwgXCJDaGlsZENsYWltMUVkZ2VcIiksIHUsIFwibW9kaWZ5X2NsYWltRWRnZVwiKSxcclxuICAgIF0sXHJcbiAgICByZXBvc2l0b3J5OiByZXBvc2l0b3J5XHJcbiAgfSlcclxuICBhd2FpdCByZXBvc2l0b3J5Lm5vdGlmeShjaGFuZ2VkU2NvcmVzMik7XHJcbiAgY29uc3QgY2hhbmdlZFNjb3JlczMgPSBhd2FpdCBjYWxjdWxhdGVTY29yZUFjdGlvbnMoe1xyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICBuZXcgQWN0aW9uKG5ldyBDbGFpbShcIkdyYW5kY2hpbGQgQ2xhaW0gMlwiLCBcImdyYW5kQ2hpbGQyXCIpLCB1LCBcImFkZF9jbGFpbVwiKSxcclxuICAgICAgbmV3IEFjdGlvbihuZXcgQ2xhaW1FZGdlKFwiQ2hpbGRDbGFpbTFcIiwgXCJncmFuZENoaWxkMlwiLCB1LCBmYWxzZSwgXCJHcmFuZENoaWxkQ2xhaW0yRWRnZVwiKSwgdSwgXCJhZGRfY2xhaW1FZGdlXCIpLFxyXG4gICAgXSxcclxuICAgIHJlcG9zaXRvcnk6IHJlcG9zaXRvcnlcclxuICB9KVxyXG4gIGF3YWl0IHJlcG9zaXRvcnkubm90aWZ5KGNoYW5nZWRTY29yZXMzKTtcclxufSk7Il19