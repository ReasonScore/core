"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepositoryLocalBase = void 0;

var _RsData = require("../dataModels/RsData");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class RepositoryLocalBase {
  constructor(rsData = new _RsData.RsData()) {
    this.rsData = rsData;

    _defineProperty(this, "log", []);
  }

  async getClaim(id) {
    return this.rsData.items[id];
  }

  async getClaimEdge(id) {
    return this.rsData.items[id];
  }

  async getScore(id) {
    return this.rsData.items[id];
  }

  async getScoreTree(id) {
    return this.rsData.items[id];
  }

  async getClaimEdgesByParentId(parentId) {
    const claimEdgeIdStrings = this.rsData.claimEdgeIdsByParentId[parentId];
    const claimEdges = [];

    if (claimEdgeIdStrings) {
      for (const claimEdgeIdString of claimEdgeIdStrings) {
        const claimEdge = await this.getClaimEdge(claimEdgeIdString);
        if (claimEdge) claimEdges.push(claimEdge);
      }
    }

    return claimEdges;
  }

  async getClaimEdgesByChildId(childId) {
    const claimEdgeIdStrings = this.rsData.claimEdgeIdsByChildId[childId];
    const claimEdges = [];

    for (const claimEdgeIdString of claimEdgeIdStrings) {
      const claimEdge = await this.getClaimEdge(claimEdgeIdString);
      if (claimEdge) claimEdges.push(claimEdge);
    }

    return claimEdges;
  }

  async getScoresBySourceId(sourceClaimId) {
    const scoreIdStrings = this.rsData.scoreIdsBySourceId[sourceClaimId];
    const scores = [];

    if (scoreIdStrings) {
      for (const scoreIdString of scoreIdStrings) {
        const score = await this.getScore(scoreIdString);
        if (score) scores.push(score);
      }
    }

    return scores;
  }

  async getChildrenByScoreId(parentScoreId) {
    const childIdStrings = this.rsData.childIdsByScoreId[parentScoreId];
    const scores = [];

    if (childIdStrings) {
      for (const scoreIdString of childIdStrings) {
        const score = await this.getScore(scoreIdString);
        if (score) scores.push(score);
      }
    }

    return scores;
  }

  async getDescendantScoresById(mainScoreId) {
    // TODO: This assumes no loops in the tree
    const scores = [];
    const scoresToProcess = await this.getChildrenByScoreId(mainScoreId);

    while (scoresToProcess.length > 0) {
      const currentScore = scoresToProcess.pop();

      if (currentScore) {
        scores.push(currentScore);
        const childScores = await this.getChildrenByScoreId(currentScore.id);
        scoresToProcess.push(...childScores);
      }
    }

    return scores;
  }

  async getLeafScoresById(mainScoreId) {
    // TODO: This assumes no loops in the tree
    const scores = [];
    const scoresToProcess = await this.getChildrenByScoreId(mainScoreId);

    while (scoresToProcess.length > 0) {
      const currentScore = scoresToProcess.pop();

      if (currentScore) {
        const children = await this.getChildrenByScoreId(currentScore.id);

        if (children.length === 0) {
          scores.push(currentScore);
        }

        scoresToProcess.push(...children);
      }
    }

    return scores;
  }

}

exports.RepositoryLocalBase = RepositoryLocalBase;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsQmFzZS50cyJdLCJuYW1lcyI6WyJSZXBvc2l0b3J5TG9jYWxCYXNlIiwiY29uc3RydWN0b3IiLCJyc0RhdGEiLCJSc0RhdGEiLCJnZXRDbGFpbSIsImlkIiwiaXRlbXMiLCJnZXRDbGFpbUVkZ2UiLCJnZXRTY29yZSIsImdldFNjb3JlVHJlZSIsImdldENsYWltRWRnZXNCeVBhcmVudElkIiwicGFyZW50SWQiLCJjbGFpbUVkZ2VJZFN0cmluZ3MiLCJjbGFpbUVkZ2VJZHNCeVBhcmVudElkIiwiY2xhaW1FZGdlcyIsImNsYWltRWRnZUlkU3RyaW5nIiwiY2xhaW1FZGdlIiwicHVzaCIsImdldENsYWltRWRnZXNCeUNoaWxkSWQiLCJjaGlsZElkIiwiY2xhaW1FZGdlSWRzQnlDaGlsZElkIiwiZ2V0U2NvcmVzQnlTb3VyY2VJZCIsInNvdXJjZUNsYWltSWQiLCJzY29yZUlkU3RyaW5ncyIsInNjb3JlSWRzQnlTb3VyY2VJZCIsInNjb3JlcyIsInNjb3JlSWRTdHJpbmciLCJzY29yZSIsImdldENoaWxkcmVuQnlTY29yZUlkIiwicGFyZW50U2NvcmVJZCIsImNoaWxkSWRTdHJpbmdzIiwiY2hpbGRJZHNCeVNjb3JlSWQiLCJnZXREZXNjZW5kYW50U2NvcmVzQnlJZCIsIm1haW5TY29yZUlkIiwic2NvcmVzVG9Qcm9jZXNzIiwibGVuZ3RoIiwiY3VycmVudFNjb3JlIiwicG9wIiwiY2hpbGRTY29yZXMiLCJnZXRMZWFmU2NvcmVzQnlJZCIsImNoaWxkcmVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBRUE7Ozs7QUFNTyxNQUFNQSxtQkFBTixDQUEwQjtBQUU3QkMsRUFBQUEsV0FBVyxDQUNBQyxNQUFjLEdBQUcsSUFBSUMsY0FBSixFQURqQixFQUVUO0FBQUEsU0FEU0QsTUFDVCxHQURTQSxNQUNUOztBQUFBLGlDQXVGZ0MsRUF2RmhDO0FBQ0Q7O0FBRWEsUUFBUkUsUUFBUSxDQUFDQyxFQUFE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Q0FBQ0MsTUFBaEIsR0FBeUIsQ0FBaEMsRUFBbUM7QUFDL0IsWUFBTUMsWUFBWSxHQUFHRixlQUFlLENBQUNHLEdBQWhCLEVBQXJCOztBQUNBLFVBQUlELFlBQUosRUFBa0I7QUFDZFgsUUFBQUEsTUFBTSxDQUFDUixJQUFQLENBQVltQixZQUFaO0FBQ0EsY0FBTUUsV0FBVyxHQUFHLE1BQU0sS0FBS1Ysb0JBQUwsQ0FBMEJRLFlBQVksQ0FBQy9CLEVBQXZDLENBQTFCO0FBQ0E2QixRQUFBQSxlQUFlLENBQUNqQixJQUFoQixDQUFxQixHQUFHcUIsV0FBeEI7QUFDSDtBQUNKOztBQUNELFdBQU9iLE1BQVA7QUFDSDs7QUFDc0IsUUFBakJjLGlCQUFpQixDQUFDTixXQUFELEVBQXdDO0FBQzNEO0FBQ0EsVUFBTVIsTUFBZSxHQUFHLEVBQXhCO0FBQ0EsVUFBTVMsZUFBZSxHQUFHLE1BQU0sS0FBS04sb0JBQUwsQ0FBMEJLLFdBQTFCLENBQTlCOztBQUNBLFdBQU9DLGVBQWUsQ0FBQ0MsTUFBaEIsR0FBeUIsQ0FBaEMsRUFBbUM7QUFDL0IsWUFBTUMsWUFBWSxHQUFHRixlQUFlLENBQUNHLEdBQWhCLEVBQXJCOztBQUNBLFVBQUlELFlBQUosRUFBa0I7QUFDZCxjQUFNSSxRQUFRLEdBQUcsTUFBTSxLQUFLWixvQkFBTCxDQUEwQlEsWUFBWSxDQUFDL0IsRUFBdkMsQ0FBdkI7O0FBQ0EsWUFBSW1DLFFBQVEsQ0FBQ0wsTUFBVCxLQUFvQixDQUF4QixFQUEyQjtBQUN2QlYsVUFBQUEsTUFBTSxDQUFDUixJQUFQLENBQVltQixZQUFaO0FBQ0g7O0FBQ0RGLFFBQUFBLGVBQWUsQ0FBQ2pCLElBQWhCLENBQXFCLEdBQUd1QixRQUF4QjtBQUNIO0FBQ0o7O0FBQ0QsV0FBT2YsTUFBUDtBQUNIOztBQTFGNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGFpbUVkZ2UgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9DbGFpbUVkZ2VcIjtcclxuaW1wb3J0IHsgU2NvcmUgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9TY29yZVwiO1xyXG5pbXBvcnQgeyBSc0RhdGEgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9Sc0RhdGFcIjtcclxuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQWN0aW9uXCI7XHJcbmltcG9ydCB7IENsYWltIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1cIjtcclxuaW1wb3J0IHsgU2NvcmVUcmVlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvU2NvcmVUcmVlXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFJlcG9zaXRvcnlMb2NhbEJhc2Uge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyByc0RhdGE6IFJzRGF0YSA9IG5ldyBSc0RhdGEoKVxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZ2V0Q2xhaW0oaWQ6IHN0cmluZyk6IFByb21pc2U8Q2xhaW0gfCB1bmRlZmluZWQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yc0RhdGEuaXRlbXNbaWRdIGFzIENsYWltO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0Q2xhaW1FZGdlKGlkOiBzdHJpbmcpOiBQcm9taXNlPENsYWltRWRnZSB8IHVuZGVmaW5lZD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJzRGF0YS5pdGVtc1tpZF0gYXMgQ2xhaW1FZGdlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0U2NvcmUoaWQ6IHN0cmluZyk6IFByb21pc2U8U2NvcmUgfCB1bmRlZmluZWQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yc0RhdGEuaXRlbXNbaWRdIGFzIFNjb3JlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0U2NvcmVUcmVlKGlkOiBzdHJpbmcpOiBQcm9taXNlPFNjb3JlVHJlZSB8IHVuZGVmaW5lZD4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJzRGF0YS5pdGVtc1tpZF0gYXMgU2NvcmVUcmVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0Q2xhaW1FZGdlc0J5UGFyZW50SWQocGFyZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Q2xhaW1FZGdlW10+IHtcclxuICAgICAgICBjb25zdCBjbGFpbUVkZ2VJZFN0cmluZ3MgPSB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VJZHNCeVBhcmVudElkW3BhcmVudElkXTtcclxuICAgICAgICBjb25zdCBjbGFpbUVkZ2VzOiBDbGFpbUVkZ2VbXSA9IFtdO1xyXG4gICAgICAgIGlmIChjbGFpbUVkZ2VJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBjbGFpbUVkZ2VJZFN0cmluZyBvZiBjbGFpbUVkZ2VJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNsYWltRWRnZSA9IGF3YWl0IHRoaXMuZ2V0Q2xhaW1FZGdlKGNsYWltRWRnZUlkU3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgaWYgKGNsYWltRWRnZSkgY2xhaW1FZGdlcy5wdXNoKGNsYWltRWRnZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2xhaW1FZGdlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0Q2xhaW1FZGdlc0J5Q2hpbGRJZChjaGlsZElkOiBzdHJpbmcpOiBQcm9taXNlPENsYWltRWRnZVtdPiB7XHJcbiAgICAgICAgY29uc3QgY2xhaW1FZGdlSWRTdHJpbmdzID0gdGhpcy5yc0RhdGEuY2xhaW1FZGdlSWRzQnlDaGlsZElkW2NoaWxkSWRdO1xyXG4gICAgICAgIGNvbnN0IGNsYWltRWRnZXM6IENsYWltRWRnZVtdID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBjbGFpbUVkZ2VJZFN0cmluZyBvZiBjbGFpbUVkZ2VJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgY2xhaW1FZGdlID0gYXdhaXQgdGhpcy5nZXRDbGFpbUVkZ2UoY2xhaW1FZGdlSWRTdHJpbmcpXHJcbiAgICAgICAgICAgIGlmIChjbGFpbUVkZ2UpIGNsYWltRWRnZXMucHVzaChjbGFpbUVkZ2UpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjbGFpbUVkZ2VzXHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRTY29yZXNCeVNvdXJjZUlkKHNvdXJjZUNsYWltSWQ6IHN0cmluZyk6IFByb21pc2U8U2NvcmVbXT4ge1xyXG4gICAgICAgIGNvbnN0IHNjb3JlSWRTdHJpbmdzID0gdGhpcy5yc0RhdGEuc2NvcmVJZHNCeVNvdXJjZUlkW3NvdXJjZUNsYWltSWRdO1xyXG4gICAgICAgIGNvbnN0IHNjb3JlczogU2NvcmVbXSA9IFtdO1xyXG4gICAgICAgIGlmIChzY29yZUlkU3RyaW5ncykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNjb3JlSWRTdHJpbmcgb2Ygc2NvcmVJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gYXdhaXQgdGhpcy5nZXRTY29yZShzY29yZUlkU3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3JlKSBzY29yZXMucHVzaChzY29yZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2NvcmVzXHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRDaGlsZHJlbkJ5U2NvcmVJZChwYXJlbnRTY29yZUlkOiBzdHJpbmcpOiBQcm9taXNlPFNjb3JlW10+IHtcclxuICAgICAgICBjb25zdCBjaGlsZElkU3RyaW5ncyA9IHRoaXMucnNEYXRhLmNoaWxkSWRzQnlTY29yZUlkW3BhcmVudFNjb3JlSWRdO1xyXG4gICAgICAgIGNvbnN0IHNjb3JlczogU2NvcmVbXSA9IFtdO1xyXG4gICAgICAgIGlmIChjaGlsZElkU3RyaW5ncykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNjb3JlSWRTdHJpbmcgb2YgY2hpbGRJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gYXdhaXQgdGhpcy5nZXRTY29yZShzY29yZUlkU3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3JlKSBzY29yZXMucHVzaChzY29yZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2NvcmVzXHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXREZXNjZW5kYW50U2NvcmVzQnlJZChtYWluU2NvcmVJZDogc3RyaW5nKTogUHJvbWlzZTxTY29yZVtdPiB7XHJcbiAgICAgICAgLy8gVE9ETzogVGhpcyBhc3N1bWVzIG5vIGxvb3BzIGluIHRoZSB0cmVlXHJcbiAgICAgICAgY29uc3Qgc2NvcmVzOiBTY29yZVtdID0gW107XHJcbiAgICAgICAgY29uc3Qgc2NvcmVzVG9Qcm9jZXNzID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbkJ5U2NvcmVJZChtYWluU2NvcmVJZCk7XHJcbiAgICAgICAgd2hpbGUgKHNjb3Jlc1RvUHJvY2Vzcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY29yZSA9IHNjb3Jlc1RvUHJvY2Vzcy5wb3AoKTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTY29yZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcmVzLnB1c2goY3VycmVudFNjb3JlKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkU2NvcmVzID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbkJ5U2NvcmVJZChjdXJyZW50U2NvcmUuaWQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcmVzVG9Qcm9jZXNzLnB1c2goLi4uY2hpbGRTY29yZXMpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3Jlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0TGVhZlNjb3Jlc0J5SWQobWFpblNjb3JlSWQ6IHN0cmluZyk6IFByb21pc2U8U2NvcmVbXT4ge1xyXG4gICAgICAgIC8vIFRPRE86IFRoaXMgYXNzdW1lcyBubyBsb29wcyBpbiB0aGUgdHJlZVxyXG4gICAgICAgIGNvbnN0IHNjb3JlczogU2NvcmVbXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHNjb3Jlc1RvUHJvY2VzcyA9IGF3YWl0IHRoaXMuZ2V0Q2hpbGRyZW5CeVNjb3JlSWQobWFpblNjb3JlSWQpO1xyXG4gICAgICAgIHdoaWxlIChzY29yZXNUb1Byb2Nlc3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBzY29yZXNUb1Byb2Nlc3MucG9wKCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2NvcmUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbkJ5U2NvcmVJZChjdXJyZW50U2NvcmUuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlcy5wdXNoKGN1cnJlbnRTY29yZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzY29yZXNUb1Byb2Nlc3MucHVzaCguLi5jaGlsZHJlbilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2NvcmVzXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgbG9nOiBBY3Rpb25bXVtdID0gW107XHJcblxyXG59Il19