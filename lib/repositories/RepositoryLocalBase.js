"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepositoryLocalBase = void 0;

var _RsData = require("../dataModels/RsData");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class RepositoryLocalBase {
  constructor(rsData = new _RsData.RsData()) {
    this.rsData = rsData;

    _defineProperty(this, "log", []);
  }

  async getClaim(id) {
    return this.rsData.items[id];
  }

  async getClaimEdge(id) {
    return this.rsData.items[id];
  }

  async getScore(id) {
    return this.rsData.items[id];
  }

  async getScoreTree(id) {
    return this.rsData.items[id];
  }

  async getClaimEdgesByParentId(parentId) {
    const claimEdgeIdStrings = this.rsData.claimEdgeIdsByParentId[parentId];
    const claimEdges = [];

    if (claimEdgeIdStrings) {
      for (const claimEdgeIdString of claimEdgeIdStrings) {
        const claimEdge = await this.getClaimEdge(claimEdgeIdString);
        if (claimEdge) claimEdges.push(claimEdge);
      }
    }

    return claimEdges;
  }

  async getClaimEdgesByChildId(childId) {
    const claimEdgeIdStrings = this.rsData.claimEdgeIdsByChildId[childId];
    const claimEdges = [];

    for (const claimEdgeIdString of claimEdgeIdStrings) {
      const claimEdge = await this.getClaimEdge(claimEdgeIdString);
      if (claimEdge) claimEdges.push(claimEdge);
    }

    return claimEdges;
  }

  async getScoresBySourceId(sourceClaimId) {
    const scoreIdStrings = this.rsData.scoreIdsBySourceId[sourceClaimId];
    const scores = [];

    if (scoreIdStrings) {
      for (const scoreIdString of scoreIdStrings) {
        const score = await this.getScore(scoreIdString);
        if (score) scores.push(score);
      }
    }

    return scores;
  }

  async getChildrenByScoreId(parentScoreId) {
    const childIdStrings = this.rsData.childIdsByScoreId[parentScoreId];
    const scores = [];

    if (childIdStrings) {
      for (const scoreIdString of childIdStrings) {
        const score = await this.getScore(scoreIdString);
        if (score) scores.push(score);
      }
    }

    return scores;
  }

  async getDescendantScoresById(mainScoreId) {
    // TODO: This assumes no loops in the tree
    const scores = [];
    const scoresToProcess = await this.getChildrenByScoreId(mainScoreId);

    while (scoresToProcess.length > 0) {
      const currentScore = scoresToProcess.pop();

      if (currentScore) {
        scores.push(currentScore);
        scoresToProcess.push(...(await this.getChildrenByScoreId(currentScore.id)));
      }
    }

    return scores;
  }

  async getLeafScoresById(mainScoreId) {
    // TODO: This assumes no loops in the tree
    const scores = [];
    const scoresToProcess = await this.getChildrenByScoreId(mainScoreId);

    while (scoresToProcess.length > 0) {
      const currentScore = scoresToProcess.pop();

      if (currentScore) {
        const children = await this.getChildrenByScoreId(currentScore.id);

        if (children.length === 0) {
          scores.push(currentScore);
        }

        scoresToProcess.push(...children);
      }
    }

    return scores;
  }

}

exports.RepositoryLocalBase = RepositoryLocalBase;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsQmFzZS50cyJdLCJuYW1lcyI6WyJSZXBvc2l0b3J5TG9jYWxCYXNlIiwiY29uc3RydWN0b3IiLCJyc0RhdGEiLCJSc0RhdGEiLCJnZXRDbGFpbSIsImlkIiwiaXRlbXMiLCJnZXRDbGFpbUVkZ2UiLCJnZXRTY29yZSIsImdldFNjb3JlVHJlZSIsImdldENsYWltRWRnZXNCeVBhcmVudElkIiwicGFyZW50SWQiLCJjbGFpbUVkZ2VJZFN0cmluZ3MiLCJjbGFpbUVkZ2VJZHNCeVBhcmVudElkIiwiY2xhaW1FZGdlcyIsImNsYWltRWRnZUlkU3RyaW5nIiwiY2xhaW1FZGdlIiwicHVzaCIsImdldENsYWltRWRnZXNCeUNoaWxkSWQiLCJjaGlsZElkIiwiY2xhaW1FZGdlSWRzQnlDaGlsZElkIiwiZ2V0U2NvcmVzQnlTb3VyY2VJZCIsInNvdXJjZUNsYWltSWQiLCJzY29yZUlkU3RyaW5ncyIsInNjb3JlSWRzQnlTb3VyY2VJZCIsInNjb3JlcyIsInNjb3JlSWRTdHJpbmciLCJzY29yZSIsImdldENoaWxkcmVuQnlTY29yZUlkIiwicGFyZW50U2NvcmVJZCIsImNoaWxkSWRTdHJpbmdzIiwiY2hpbGRJZHNCeVNjb3JlSWQiLCJnZXREZXNjZW5kYW50U2NvcmVzQnlJZCIsIm1haW5TY29yZUlkIiwic2NvcmVzVG9Qcm9jZXNzIiwibGVuZ3RoIiwiY3VycmVudFNjb3JlIiwicG9wIiwiZ2V0TGVhZlNjb3Jlc0J5SWQiLCJjaGlsZHJlbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOzs7O0FBTU8sTUFBTUEsbUJBQU4sQ0FBMEI7QUFFN0JDLEVBQUFBLFdBQVcsQ0FDQUMsTUFBYyxHQUFHLElBQUlDLGNBQUosRUFEakIsRUFFVDtBQUFBLFNBRFNELE1BQ1QsR0FEU0EsTUFDVDs7QUFBQSxpQ0FzRmdDLEVBdEZoQztBQUNEOztBQUVhLFFBQVJFLFFBQVEsQ0FBQ0MsRUFBRCxFQUF5QztBQUNuRCxX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QXlCLENBQWhDLEVBQW1DO0FBQy9CLFlBQU1DLFlBQVksR0FBR0YsZUFBZSxDQUFDRyxHQUFoQixFQUFyQjs7QUFDQSxVQUFJRCxZQUFKLEVBQWtCO0FBQ2RYLFFBQUFBLE1BQU0sQ0FBQ1IsSUFBUCxDQUFZbUIsWUFBWjtBQUNBRixRQUFBQSxlQUFlLENBQUNqQixJQUFoQixDQUFxQixJQUFHLE1BQU0sS0FBS1csb0JBQUwsQ0FBMEJRLFlBQVksQ0FBQy9CLEVBQXZDLENBQVQsQ0FBckI7QUFDSDtBQUNKOztBQUNELFdBQU9vQixNQUFQO0FBQ0g7O0FBQ3NCLFFBQWpCYSxpQkFBaUIsQ0FBQ0wsV0FBRCxFQUF3QztBQUMzRDtBQUNBLFVBQU1SLE1BQWUsR0FBRyxFQUF4QjtBQUNBLFVBQU1TLGVBQWUsR0FBRyxNQUFNLEtBQUtOLG9CQUFMLENBQTBCSyxXQUExQixDQUE5Qjs7QUFDQSxXQUFPQyxlQUFlLENBQUNDLE1BQWhCLEdBQXlCLENBQWhDLEVBQW1DO0FBQy9CLFlBQU1DLFlBQVksR0FBR0YsZUFBZSxDQUFDRyxHQUFoQixFQUFyQjs7QUFDQSxVQUFJRCxZQUFKLEVBQWtCO0FBQ2QsY0FBTUcsUUFBUSxHQUFHLE1BQU0sS0FBS1gsb0JBQUwsQ0FBMEJRLFlBQVksQ0FBQy9CLEVBQXZDLENBQXZCOztBQUNBLFlBQUlrQyxRQUFRLENBQUNKLE1BQVQsS0FBb0IsQ0FBeEIsRUFBMkI7QUFDdkJWLFVBQUFBLE1BQU0sQ0FBQ1IsSUFBUCxDQUFZbUIsWUFBWjtBQUNIOztBQUNERixRQUFBQSxlQUFlLENBQUNqQixJQUFoQixDQUFxQixHQUFHc0IsUUFBeEI7QUFDSDtBQUNKOztBQUNELFdBQU9kLE1BQVA7QUFDSDs7QUF6RjRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xhaW1FZGdlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1FZGdlXCI7XHJcbmltcG9ydCB7IFNjb3JlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvU2NvcmVcIjtcclxuaW1wb3J0IHsgUnNEYXRhIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvUnNEYXRhXCI7XHJcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gXCIuLi9kYXRhTW9kZWxzL0FjdGlvblwiO1xyXG5pbXBvcnQgeyBDbGFpbSB9IGZyb20gXCIuLi9kYXRhTW9kZWxzL0NsYWltXCI7XHJcbmltcG9ydCB7IFNjb3JlVHJlZSB9IGZyb20gXCIuLi9kYXRhTW9kZWxzL1Njb3JlVHJlZVwiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5TG9jYWxCYXNlIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgcnNEYXRhOiBSc0RhdGEgPSBuZXcgUnNEYXRhKClcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGdldENsYWltKGlkOiBzdHJpbmcpOiBQcm9taXNlPENsYWltIHwgdW5kZWZpbmVkPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnNEYXRhLml0ZW1zW2lkXSBhcyBDbGFpbTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldENsYWltRWRnZShpZDogc3RyaW5nKTogUHJvbWlzZTxDbGFpbUVkZ2UgfCB1bmRlZmluZWQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yc0RhdGEuaXRlbXNbaWRdIGFzIENsYWltRWRnZTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldFNjb3JlKGlkOiBzdHJpbmcpOiBQcm9taXNlPFNjb3JlIHwgdW5kZWZpbmVkPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucnNEYXRhLml0ZW1zW2lkXSBhcyBTY29yZTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldFNjb3JlVHJlZShpZDogc3RyaW5nKTogUHJvbWlzZTxTY29yZVRyZWUgfCB1bmRlZmluZWQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yc0RhdGEuaXRlbXNbaWRdIGFzIFNjb3JlVHJlZTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldENsYWltRWRnZXNCeVBhcmVudElkKHBhcmVudElkOiBzdHJpbmcpOiBQcm9taXNlPENsYWltRWRnZVtdPiB7XHJcbiAgICAgICAgY29uc3QgY2xhaW1FZGdlSWRTdHJpbmdzID0gdGhpcy5yc0RhdGEuY2xhaW1FZGdlSWRzQnlQYXJlbnRJZFtwYXJlbnRJZF07XHJcbiAgICAgICAgY29uc3QgY2xhaW1FZGdlczogQ2xhaW1FZGdlW10gPSBbXTtcclxuICAgICAgICBpZiAoY2xhaW1FZGdlSWRTdHJpbmdzKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2xhaW1FZGdlSWRTdHJpbmcgb2YgY2xhaW1FZGdlSWRTdHJpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjbGFpbUVkZ2UgPSBhd2FpdCB0aGlzLmdldENsYWltRWRnZShjbGFpbUVkZ2VJZFN0cmluZylcclxuICAgICAgICAgICAgICAgIGlmIChjbGFpbUVkZ2UpIGNsYWltRWRnZXMucHVzaChjbGFpbUVkZ2UpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNsYWltRWRnZXNcclxuICAgIH1cclxuICAgIGFzeW5jIGdldENsYWltRWRnZXNCeUNoaWxkSWQoY2hpbGRJZDogc3RyaW5nKTogUHJvbWlzZTxDbGFpbUVkZ2VbXT4ge1xyXG4gICAgICAgIGNvbnN0IGNsYWltRWRnZUlkU3RyaW5ncyA9IHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5Q2hpbGRJZFtjaGlsZElkXTtcclxuICAgICAgICBjb25zdCBjbGFpbUVkZ2VzOiBDbGFpbUVkZ2VbXSA9IFtdO1xyXG4gICAgICAgIGZvciAoY29uc3QgY2xhaW1FZGdlSWRTdHJpbmcgb2YgY2xhaW1FZGdlSWRTdHJpbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNsYWltRWRnZSA9IGF3YWl0IHRoaXMuZ2V0Q2xhaW1FZGdlKGNsYWltRWRnZUlkU3RyaW5nKVxyXG4gICAgICAgICAgICBpZiAoY2xhaW1FZGdlKSBjbGFpbUVkZ2VzLnB1c2goY2xhaW1FZGdlKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2xhaW1FZGdlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0U2NvcmVzQnlTb3VyY2VJZChzb3VyY2VDbGFpbUlkOiBzdHJpbmcpOiBQcm9taXNlPFNjb3JlW10+IHtcclxuICAgICAgICBjb25zdCBzY29yZUlkU3RyaW5ncyA9IHRoaXMucnNEYXRhLnNjb3JlSWRzQnlTb3VyY2VJZFtzb3VyY2VDbGFpbUlkXTtcclxuICAgICAgICBjb25zdCBzY29yZXM6IFNjb3JlW10gPSBbXTtcclxuICAgICAgICBpZiAoc2NvcmVJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBzY29yZUlkU3RyaW5nIG9mIHNjb3JlSWRTdHJpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzY29yZSA9IGF3YWl0IHRoaXMuZ2V0U2NvcmUoc2NvcmVJZFN0cmluZylcclxuICAgICAgICAgICAgICAgIGlmIChzY29yZSkgc2NvcmVzLnB1c2goc2NvcmUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3Jlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0Q2hpbGRyZW5CeVNjb3JlSWQocGFyZW50U2NvcmVJZDogc3RyaW5nKTogUHJvbWlzZTxTY29yZVtdPiB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRJZFN0cmluZ3MgPSB0aGlzLnJzRGF0YS5jaGlsZElkc0J5U2NvcmVJZFtwYXJlbnRTY29yZUlkXTtcclxuICAgICAgICBjb25zdCBzY29yZXM6IFNjb3JlW10gPSBbXTtcclxuICAgICAgICBpZiAoY2hpbGRJZFN0cmluZ3MpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBzY29yZUlkU3RyaW5nIG9mIGNoaWxkSWRTdHJpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzY29yZSA9IGF3YWl0IHRoaXMuZ2V0U2NvcmUoc2NvcmVJZFN0cmluZylcclxuICAgICAgICAgICAgICAgIGlmIChzY29yZSkgc2NvcmVzLnB1c2goc2NvcmUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3Jlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0RGVzY2VuZGFudFNjb3Jlc0J5SWQobWFpblNjb3JlSWQ6IHN0cmluZyk6IFByb21pc2U8U2NvcmVbXT4ge1xyXG4gICAgICAgIC8vIFRPRE86IFRoaXMgYXNzdW1lcyBubyBsb29wcyBpbiB0aGUgdHJlZVxyXG4gICAgICAgIGNvbnN0IHNjb3JlczogU2NvcmVbXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHNjb3Jlc1RvUHJvY2VzcyA9IGF3YWl0IHRoaXMuZ2V0Q2hpbGRyZW5CeVNjb3JlSWQobWFpblNjb3JlSWQpO1xyXG4gICAgICAgIHdoaWxlIChzY29yZXNUb1Byb2Nlc3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBzY29yZXNUb1Byb2Nlc3MucG9wKCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2NvcmUpIHtcclxuICAgICAgICAgICAgICAgIHNjb3Jlcy5wdXNoKGN1cnJlbnRTY29yZSk7XHJcbiAgICAgICAgICAgICAgICBzY29yZXNUb1Byb2Nlc3MucHVzaCguLi5hd2FpdCB0aGlzLmdldENoaWxkcmVuQnlTY29yZUlkKGN1cnJlbnRTY29yZS5pZCkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3Jlc1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0TGVhZlNjb3Jlc0J5SWQobWFpblNjb3JlSWQ6IHN0cmluZyk6IFByb21pc2U8U2NvcmVbXT4ge1xyXG4gICAgICAgIC8vIFRPRE86IFRoaXMgYXNzdW1lcyBubyBsb29wcyBpbiB0aGUgdHJlZVxyXG4gICAgICAgIGNvbnN0IHNjb3JlczogU2NvcmVbXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHNjb3Jlc1RvUHJvY2VzcyA9IGF3YWl0IHRoaXMuZ2V0Q2hpbGRyZW5CeVNjb3JlSWQobWFpblNjb3JlSWQpO1xyXG4gICAgICAgIHdoaWxlIChzY29yZXNUb1Byb2Nlc3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBzY29yZXNUb1Byb2Nlc3MucG9wKCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50U2NvcmUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbkJ5U2NvcmVJZChjdXJyZW50U2NvcmUuaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlcy5wdXNoKGN1cnJlbnRTY29yZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzY29yZXNUb1Byb2Nlc3MucHVzaCguLi5jaGlsZHJlbilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2NvcmVzXHJcbiAgICB9XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgbG9nOiBBY3Rpb25bXVtdID0gW107XHJcblxyXG59Il19