"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepositoryLocalReactive = void 0;

var _RsData = require("../dataModels/RsData");

var _RepositoryLocalBase = require("./RepositoryLocalBase");

class RepositoryLocalReactive extends _RepositoryLocalBase.RepositoryLocalBase {
  constructor(rsData = new _RsData.RsData()) {
    super(rsData);
    this.rsData = rsData;
  }

  notify(actions) {
    for (const action of actions) {
      // "add_claim" |
      if (action.type == "add_claim" || action.type == "modify_claim") {
        this.rsData.claims[action.dataId] = action.newData;
      }

      if (action.type == "delete_claim") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_claimEdge" || action.type == "modify_claimEdge") {
        this.rsData.claimEdges[action.dataId] = action.newData;
        const item = action.newData;
        this.indexClaimEdgeIdByParentId(item);
        this.indexClaimEdgeIdByChildId(item);
      }

      if (action.type == "delete_claimEdge") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_score" || action.type == "modify_score") {
        const item = action.newData;
        this.rsData.scores[action.dataId] = action.newData;
        this.scoreIdsByClaimId(item);
        this.childIdsByScoreId(item);
      }

      if (action.type == "delete_score") {
        throw new Error("Method not implemented.");
      }
    }
  }

  indexClaimEdgeIdByParentId(claimEdge) {
    let indexId = claimEdge.parentId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByParentId[claimEdge.parentId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByParentId[claimEdge.parentId] = destination;
    }

    if (!destination.includes(claimEdge.id)) {
      destination.push(claimEdge.id);
    }
  }

  indexClaimEdgeIdByChildId(claimEdge) {
    let indexId = claimEdge.childId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByChildId[indexId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByChildId[indexId] = destination;
    }

    if (!destination.includes(id)) {
      destination.push(id);
    }
  }

  scoreIdsByClaimId(score) {
    let indexId = score.sourceClaimId;
    let id = score.id;
    let destination = this.rsData.scoreIdsByClaimId[indexId];

    if (!destination) {
      destination = [];
      this.rsData.scoreIdsByClaimId[indexId] = destination;
    }

    if (!destination.includes(id)) {
      destination.push(id);
    }
  } //TODO: not sure if this is correct


  childIdsByScoreId(score) {
    let indexId = score.parentScoreId;
    let id = score.id;

    if (indexId) {
      let destination = this.rsData.childIdsByScoreId[indexId];

      if (!destination) {
        destination = [];
        this.rsData.childIdsByScoreId[indexId] = destination;
      }

      if (!destination.includes(id)) {
        destination.push(id);
      }
    }
  }

}

exports.RepositoryLocalReactive = RepositoryLocalReactive;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUudHMiXSwibmFtZXMiOlsiUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUiLCJSZXBvc2l0b3J5TG9jYWxCYXNlIiwiY29uc3RydWN0b3IiLCJyc0RhdGEiLCJSc0RhdGEiLCJub3RpZnkiLCJhY3Rpb25zIiwiYWN0aW9uIiwidHlwZSIsImNsYWltcyIsImRhdGFJZCIsIm5ld0RhdGEiLCJFcnJvciIsImNsYWltRWRnZXMiLCJpdGVtIiwiaW5kZXhDbGFpbUVkZ2VJZEJ5UGFyZW50SWQiLCJpbmRleENsYWltRWRnZUlkQnlDaGlsZElkIiwic2NvcmVzIiwic2NvcmVJZHNCeUNsYWltSWQiLCJjaGlsZElkc0J5U2NvcmVJZCIsImNsYWltRWRnZSIsImluZGV4SWQiLCJwYXJlbnRJZCIsImlkIiwiZGVzdGluYXRpb24iLCJjbGFpbUVkZ2VJZHNCeVBhcmVudElkIiwiaW5jbHVkZXMiLCJwdXNoIiwiY2hpbGRJZCIsImNsYWltRWRnZUlkc0J5Q2hpbGRJZCIsInNjb3JlIiwic291cmNlQ2xhaW1JZCIsInBhcmVudFNjb3JlSWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFFQTs7QUFJQTs7QUFJTyxNQUFNQSx1QkFBTixTQUFzQ0Msd0NBQXRDLENBQWlGO0FBRXBGQyxFQUFBQSxXQUFXLENBQ0FDLE1BQWUsR0FBRyxJQUFJQyxjQUFKLEVBRGxCLEVBRVQ7QUFDRSxVQUFNRCxNQUFOO0FBREYsU0FEU0EsTUFDVCxHQURTQSxNQUNUO0FBRUQ7O0FBRURFLEVBQUFBLE1BQU0sQ0FBQ0MsT0FBRCxFQUEyQjtBQUM3QixTQUFLLE1BQU1DLE1BQVgsSUFBcUJELE9BQXJCLEVBQThCO0FBQzFCO0FBQ0EsVUFBSUMsTUFBTSxDQUFDQyxJQUFQLElBQWUsV0FBZixJQUNBRCxNQUFNLENBQUNDLElBQVAsSUFBZSxjQURuQixFQUNtQztBQUMvQixhQUFLTCxNQUFMLENBQVlNLE1BQVosQ0FBbUJGLE1B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Q1AsRUFBZjtBQUNBLFFBQUlDLFdBQVcsR0FBRyxLQUFLckIsTUFBTCxDQUFZZSxpQkFBWixDQUE4QkcsT0FBOUIsQ0FBbEI7O0FBQ0EsUUFBSSxDQUFDRyxXQUFMLEVBQWtCO0FBQ2RBLE1BQUFBLFdBQVcsR0FBRyxFQUFkO0FBQ0EsV0FBS3JCLE1BQUwsQ0FBWWUsaUJBQVosQ0FBOEJHLE9BQTlCLElBQXlDRyxXQUF6QztBQUNIOztBQUNELFFBQUksQ0FBQ0EsV0FBVyxDQUFDRSxRQUFaLENBQXFCSCxFQUFyQixDQUFMLEVBQStCO0FBQzNCQyxNQUFBQSxXQUFXLENBQUNHLElBQVosQ0FBaUJKLEVBQWpCO0FBQ0g7QUFDSixHQTlFbUYsQ0FnRnBGOzs7QUFDUUosRUFBQUEsaUJBQVIsQ0FBMEJXLEtBQTFCLEVBQXlDO0FBQ3JDLFFBQUlULE9BQU8sR0FBR1MsS0FBSyxDQUFDRSxhQUFwQjtBQUNBLFFBQUlULEVBQUUsR0FBR08sS0FBSyxDQUFDUCxFQUFmOztBQUNBLFFBQUlGLE9BQUosRUFBYTtBQUNULFVBQUlHLFdBQVcsR0FBRyxLQUFLckIsTUFBTCxDQUFZZ0IsaUJBQVosQ0FBOEJFLE9BQTlCLENBQWxCOztBQUNBLFVBQUksQ0FBQ0csV0FBTCxFQUFrQjtBQUNkQSxRQUFBQSxXQUFXLEdBQUcsRUFBZDtBQUNBLGFBQUtyQixNQUFMLENBQVlnQixpQkFBWixDQUE4QkUsT0FBOUIsSUFBeUNHLFdBQXpDO0FBQ0g7O0FBQ0QsVUFBSSxDQUFDQSxXQUFXLENBQUNFLFFBQVosQ0FBcUJILEVBQXJCLENBQUwsRUFBK0I7QUFDM0JDLFFBQUFBLFdBQVcsQ0FBQ0csSUFBWixDQUFpQkosRUFBakI7QUFDSDtBQUNKO0FBQ0o7O0FBOUZtRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlDbGFpbUVkZ2UsIENsYWltRWRnZSB9IGZyb20gXCIuLi9kYXRhTW9kZWxzL0NsYWltRWRnZVwiO1xyXG5pbXBvcnQgeyBpU2NvcmUsIFNjb3JlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvU2NvcmVcIjtcclxuaW1wb3J0IHsgUnNEYXRhLCBpUnNEYXRhIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvUnNEYXRhXCI7XHJcbmltcG9ydCB7IGlSZXBvc2l0b3J5IH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvaVJlcG9zaXRvcnlcIjtcclxuaW1wb3J0IHsgaUFjdGlvbiwgQWN0aW9uIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQWN0aW9uXCI7XHJcbmltcG9ydCB7IGlDbGFpbSB9IGZyb20gXCIuLi9kYXRhTW9kZWxzL0NsYWltXCI7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnlMb2NhbEJhc2UgfSBmcm9tIFwiLi9SZXBvc2l0b3J5TG9jYWxCYXNlXCI7XHJcbmltcG9ydCB7IEFjdGlvblR5cGVzIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQWN0aW9uVHlwZXNcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUgZXh0ZW5kcyBSZXBvc2l0b3J5TG9jYWxCYXNlIGltcGxlbWVudHMgaVJlcG9zaXRvcnkge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyByc0RhdGE6IGlSc0RhdGEgPSBuZXcgUnNEYXRhKClcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKHJzRGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgbm90aWZ5KGFjdGlvbnM6IGlBY3Rpb25bXSk6IHZvaWQge1xyXG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcclxuICAgICAgICAgICAgLy8gXCJhZGRfY2xhaW1cIiB8XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImFkZF9jbGFpbVwiIHx8XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24udHlwZSA9PSBcIm1vZGlmeV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbXNbYWN0aW9uLmRhdGFJZF0gPSBhY3Rpb24ubmV3RGF0YVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT0gXCJhZGRfY2xhaW1FZGdlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X2NsYWltRWRnZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VzW2FjdGlvbi5kYXRhSWRdID0gYWN0aW9uLm5ld0RhdGFcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBDbGFpbUVkZ2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4Q2xhaW1FZGdlSWRCeVBhcmVudElkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmRleENsYWltRWRnZUlkQnlDaGlsZElkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbUVkZ2VcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09IFwiYWRkX3Njb3JlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X3Njb3JlXCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBTY29yZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnNEYXRhLnNjb3Jlc1thY3Rpb24uZGF0YUlkXSA9IGFjdGlvbi5uZXdEYXRhXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3JlSWRzQnlDbGFpbUlkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZElkc0J5U2NvcmVJZChpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT0gXCJkZWxldGVfc2NvcmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbmRleENsYWltRWRnZUlkQnlQYXJlbnRJZChjbGFpbUVkZ2U6IENsYWltRWRnZSkge1xyXG4gICAgICAgIGxldCBpbmRleElkID0gY2xhaW1FZGdlLnBhcmVudElkO1xyXG4gICAgICAgIGxldCBpZCA9IGNsYWltRWRnZS5pZFxyXG4gICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5UGFyZW50SWRbY2xhaW1FZGdlLnBhcmVudElkXTtcclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgIHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5UGFyZW50SWRbY2xhaW1FZGdlLnBhcmVudElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGNsYWltRWRnZS5pZCkpIHtcclxuICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChjbGFpbUVkZ2UuaWQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5kZXhDbGFpbUVkZ2VJZEJ5Q2hpbGRJZChjbGFpbUVkZ2U6IENsYWltRWRnZSkge1xyXG4gICAgICAgIGxldCBpbmRleElkID0gY2xhaW1FZGdlLmNoaWxkSWQ7XHJcbiAgICAgICAgbGV0IGlkID0gY2xhaW1FZGdlLmlkO1xyXG4gICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5Q2hpbGRJZFtpbmRleElkXTtcclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgIHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5Q2hpbGRJZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjb3JlSWRzQnlDbGFpbUlkKHNjb3JlOiBpU2NvcmUpIHtcclxuICAgICAgICBsZXQgaW5kZXhJZCA9IHNjb3JlLnNvdXJjZUNsYWltSWQ7XHJcbiAgICAgICAgbGV0IGlkID0gc2NvcmUuaWQ7XHJcbiAgICAgICAgbGV0IGRlc3RpbmF0aW9uID0gdGhpcy5yc0RhdGEuc2NvcmVJZHNCeUNsYWltSWRbaW5kZXhJZF07XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnJzRGF0YS5zY29yZUlkc0J5Q2xhaW1JZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvL1RPRE86IG5vdCBzdXJlIGlmIHRoaXMgaXMgY29ycmVjdFxyXG4gICAgcHJpdmF0ZSBjaGlsZElkc0J5U2NvcmVJZChzY29yZTogaVNjb3JlKSB7XHJcbiAgICAgICAgbGV0IGluZGV4SWQgPSBzY29yZS5wYXJlbnRTY29yZUlkO1xyXG4gICAgICAgIGxldCBpZCA9IHNjb3JlLmlkO1xyXG4gICAgICAgIGlmIChpbmRleElkKSB7XHJcbiAgICAgICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNoaWxkSWRzQnlTY29yZUlkW2luZGV4SWRdO1xyXG4gICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yc0RhdGEuY2hpbGRJZHNCeVNjb3JlSWRbaW5kZXhJZF0gPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChpZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=