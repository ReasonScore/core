"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepositoryLocalReactive = void 0;

var _RsData = require("../dataModels/RsData");

var _RepositoryLocalBase = require("./RepositoryLocalBase");

class RepositoryLocalReactive extends _RepositoryLocalBase.RepositoryLocalBase {
  constructor(rsData = new _RsData.RsData()) {
    super(rsData);
    this.rsData = rsData;
  }

  notify(actions) {
    this.rsData.actionsLog.push(actions);

    for (const action of actions) {
      // "add_claim" |
      if (action.type == "add_claim" || action.type == "modify_claim") {
        this.rsData.claims[action.dataId] = action.newData;
      }

      if (action.type == "delete_claim") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_claimEdge" || action.type == "modify_claimEdge") {
        this.rsData.claimEdges[action.dataId] = action.newData;
        const item = action.newData;
        this.indexClaimEdgeIdByParentId(item);
        this.indexClaimEdgeIdByChildId(item);
      }

      if (action.type == "delete_claimEdge") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_score" || action.type == "modify_score") {
        const item = action.newData;
        this.rsData.scores[action.dataId] = action.newData;
        this.scoreIdsByClaimId(item);
        this.childIdsByScoreId(item);
      }

      if (action.type == "delete_score") {
        throw new Error("Method not implemented.");
      }
    }
  }

  indexClaimEdgeIdByParentId(claimEdge) {
    let indexId = claimEdge.parentId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByParentId[claimEdge.parentId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByParentId[claimEdge.parentId] = destination;
    }

    if (!destination.includes(claimEdge.id)) {
      destination.push(claimEdge.id);
    }
  }

  indexClaimEdgeIdByChildId(claimEdge) {
    let indexId = claimEdge.childId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByChildId[indexId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByChildId[indexId] = destination;
    }

    if (!destination.includes(id)) {
      destination.push(id);
    }
  }

  scoreIdsByClaimId(score) {
    let indexId = score.sourceClaimId;
    let id = score.id;
    let destination = this.rsData.scoreIdsByClaimId[indexId];

    if (!destination) {
      destination = [];
      this.rsData.scoreIdsByClaimId[indexId] = destination;
    }

    if (!destination.includes(id)) {
      destination.push(id);
    }
  } //TODO: not sure if this is correct


  childIdsByScoreId(score) {
    let indexId = score.parentScoreId;
    let id = score.id;

    if (indexId) {
      let destination = this.rsData.childIdsByScoreId[indexId];

      if (!destination) {
        destination = [];
        this.rsData.childIdsByScoreId[indexId] = destination;
      }

      if (!destination.includes(id)) {
        destination.push(id);
      }
    }
  }

}

exports.RepositoryLocalReactive = RepositoryLocalReactive;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUudHMiXSwibmFtZXMiOlsiUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUiLCJSZXBvc2l0b3J5TG9jYWxCYXNlIiwiY29uc3RydWN0b3IiLCJyc0RhdGEiLCJSc0RhdGEiLCJub3RpZnkiLCJhY3Rpb25zIiwiYWN0aW9uc0xvZyIsInB1c2giLCJhY3Rpb24iLCJ0eXBlIiwiY2xhaW1zIiwiZGF0YUlkIiwibmV3RGF0YSIsIkVycm9yIiwiY2xhaW1FZGdlcyIsIml0ZW0iLCJpbmRleENsYWltRWRnZUlkQnlQYXJlbnRJZCIsImluZGV4Q2xhaW1FZGdlSWRCeUNoaWxkSWQiLCJzY29yZXMiLCJzY29yZUlkc0J5Q2xhaW1JZCIsImNoaWxkSWRzQnlTY29yZUlkIiwiY2xhaW1FZGdlIiwiaW5kZXhJZCIsInBhcmVudElkIiwiaWQiLCJkZXN0aW5hdGlvbiIsImNsYWltRWRnZUlkc0J5UGFyZW50SWQiLCJpbmNsdWRlcyIsImNoaWxkSWQiLCJjbGFpbUVkZ2VJZHNCeUNoaWxkSWQiLCJzY29yZSIsInNvdXJjZUNsYWltSWQiLCJwYXJlbnRTY29yZUlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBRUE7O0FBSUE7O0FBSU8sTUFBTUEsdUJBQU4sU0FBc0NDLHdDQUF0QyxDQUFpRjtBQUVwRkMsRUFBQUEsV0FBVyxDQUNBQyxNQUFlLEdBQUcsSUFBSUMsY0FBSixFQURsQixFQUVUO0FBQ0UsVUFBTUQsTUFBTjtBQURGLFNBRFNBLE1BQ1QsR0FEU0EsTUFDVDtBQUVEOztBQUVERSxFQUFBQSxNQUFNLENBQUNDLE9BQUQsRUFBMkI7QUFDN0IsU0FBS0gsTUFBTCxDQUFZSSxVQUFaLENBQXVCQyxJQUF2QixDQUE0QkYsT0FBNUI7O0FBQ0EsU0FBSyxNQUFNRyxNQUFYLElBQXFCSCxPQUFyQixFQUE4QjtBQUMxQjtBQUNBLFVBQUlHLE1BQU0sQ0FBQ0MsSUFBUCxJQUFlLFdBQWYsSUFDQUQsTUFB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O0FBQ3JDLFFBQUlSLE9BQU8sR0FBR1EsS0FBSyxDQUFDQyxhQUFwQjtBQUNBLFFBQUlQLEVBQUUsR0FBR00sS0FBSyxDQUFDTixFQUFmO0FBQ0EsUUFBSUMsV0FBVyxHQUFHLEtBQUt2QixNQUFMLENBQVlpQixpQkFBWixDQUE4QkcsT0FBOUIsQ0FBbEI7O0FBQ0EsUUFBSSxDQUFDRyxXQUFMLEVBQWtCO0FBQ2RBLE1BQUFBLFdBQVcsR0FBRyxFQUFkO0FBQ0EsV0FBS3ZCLE1BQUwsQ0FBWWlCLGlCQUFaLENBQThCRyxPQUE5QixJQUF5Q0csV0FBekM7QUFDSDs7QUFDRCxRQUFJLENBQUNBLFdBQVcsQ0FBQ0UsUUFBWixDQUFxQkgsRUFBckIsQ0FBTCxFQUErQjtBQUMzQkMsTUFBQUEsV0FBVyxDQUFDbEIsSUFBWixDQUFpQmlCLEVBQWpCO0FBQ0g7QUFDSixHQS9FbUYsQ0FpRnBGOzs7QUFDUUosRUFBQUEsaUJBQVIsQ0FBMEJVLEtBQTFCLEVBQXlDO0FBQ3JDLFFBQUlSLE9BQU8sR0FBR1EsS0FBSyxDQUFDRSxhQUFwQjtBQUNBLFFBQUlSLEVBQUUsR0FBR00sS0FBSyxDQUFDTixFQUFmOztBQUNBLFFBQUlGLE9BQUosRUFBYTtBQUNULFVBQUlHLFdBQVcsR0FBRyxLQUFLdkIsTUFBTCxDQUFZa0IsaUJBQVosQ0FBOEJFLE9BQTlCLENBQWxCOztBQUNBLFVBQUksQ0FBQ0csV0FBTCxFQUFrQjtBQUNkQSxRQUFBQSxXQUFXLEdBQUcsRUFBZDtBQUNBLGFBQUt2QixNQUFMLENBQVlrQixpQkFBWixDQUE4QkUsT0FBOUIsSUFBeUNHLFdBQXpDO0FBQ0g7O0FBQ0QsVUFBSSxDQUFDQSxXQUFXLENBQUNFLFFBQVosQ0FBcUJILEVBQXJCLENBQUwsRUFBK0I7QUFDM0JDLFFBQUFBLFdBQVcsQ0FBQ2xCLElBQVosQ0FBaUJpQixFQUFqQjtBQUNIO0FBQ0o7QUFDSjs7QUEvRm1GIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaUNsYWltRWRnZSwgQ2xhaW1FZGdlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1FZGdlXCI7XHJcbmltcG9ydCB7IGlTY29yZSwgU2NvcmUgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9TY29yZVwiO1xyXG5pbXBvcnQgeyBSc0RhdGEsIGlSc0RhdGEgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9Sc0RhdGFcIjtcclxuaW1wb3J0IHsgaVJlcG9zaXRvcnkgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9pUmVwb3NpdG9yeVwiO1xyXG5pbXBvcnQgeyBpQWN0aW9uLCBBY3Rpb24gfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9BY3Rpb25cIjtcclxuaW1wb3J0IHsgaUNsYWltIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1cIjtcclxuaW1wb3J0IHsgUmVwb3NpdG9yeUxvY2FsQmFzZSB9IGZyb20gXCIuL1JlcG9zaXRvcnlMb2NhbEJhc2VcIjtcclxuaW1wb3J0IHsgQWN0aW9uVHlwZXMgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9BY3Rpb25UeXBlc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5TG9jYWxSZWFjdGl2ZSBleHRlbmRzIFJlcG9zaXRvcnlMb2NhbEJhc2UgaW1wbGVtZW50cyBpUmVwb3NpdG9yeSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIHJzRGF0YTogaVJzRGF0YSA9IG5ldyBSc0RhdGEoKVxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIocnNEYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBub3RpZnkoYWN0aW9uczogaUFjdGlvbltdKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yc0RhdGEuYWN0aW9uc0xvZy5wdXNoKGFjdGlvbnMpO1xyXG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcclxuICAgICAgICAgICAgLy8gXCJhZGRfY2xhaW1cIiB8XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImFkZF9jbGFpbVwiIHx8XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24udHlwZSA9PSBcIm1vZGlmeV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbXNbYWN0aW9uLmRhdGFJZF0gPSBhY3Rpb24ubmV3RGF0YVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT0gXCJhZGRfY2xhaW1FZGdlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X2NsYWltRWRnZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VzW2FjdGlvbi5kYXRhSWRdID0gYWN0aW9uLm5ld0RhdGFcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBDbGFpbUVkZ2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4Q2xhaW1FZGdlSWRCeVBhcmVudElkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmRleENsYWltRWRnZUlkQnlDaGlsZElkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbUVkZ2VcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09IFwiYWRkX3Njb3JlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X3Njb3JlXCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBTY29yZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnNEYXRhLnNjb3Jlc1thY3Rpb24uZGF0YUlkXSA9IGFjdGlvbi5uZXdEYXRhXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3JlSWRzQnlDbGFpbUlkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZElkc0J5U2NvcmVJZChpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT0gXCJkZWxldGVfc2NvcmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbmRleENsYWltRWRnZUlkQnlQYXJlbnRJZChjbGFpbUVkZ2U6IENsYWltRWRnZSkge1xyXG4gICAgICAgIGxldCBpbmRleElkID0gY2xhaW1FZGdlLnBhcmVudElkO1xyXG4gICAgICAgIGxldCBpZCA9IGNsYWltRWRnZS5pZFxyXG4gICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5UGFyZW50SWRbY2xhaW1FZGdlLnBhcmVudElkXTtcclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgIHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5UGFyZW50SWRbY2xhaW1FZGdlLnBhcmVudElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGNsYWltRWRnZS5pZCkpIHtcclxuICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChjbGFpbUVkZ2UuaWQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5kZXhDbGFpbUVkZ2VJZEJ5Q2hpbGRJZChjbGFpbUVkZ2U6IENsYWltRWRnZSkge1xyXG4gICAgICAgIGxldCBpbmRleElkID0gY2xhaW1FZGdlLmNoaWxkSWQ7XHJcbiAgICAgICAgbGV0IGlkID0gY2xhaW1FZGdlLmlkO1xyXG4gICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5Q2hpbGRJZFtpbmRleElkXTtcclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgIHRoaXMucnNEYXRhLmNsYWltRWRnZUlkc0J5Q2hpbGRJZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjb3JlSWRzQnlDbGFpbUlkKHNjb3JlOiBpU2NvcmUpIHtcclxuICAgICAgICBsZXQgaW5kZXhJZCA9IHNjb3JlLnNvdXJjZUNsYWltSWQ7XHJcbiAgICAgICAgbGV0IGlkID0gc2NvcmUuaWQ7XHJcbiAgICAgICAgbGV0IGRlc3RpbmF0aW9uID0gdGhpcy5yc0RhdGEuc2NvcmVJZHNCeUNsYWltSWRbaW5kZXhJZF07XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnJzRGF0YS5zY29yZUlkc0J5Q2xhaW1JZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvL1RPRE86IG5vdCBzdXJlIGlmIHRoaXMgaXMgY29ycmVjdFxyXG4gICAgcHJpdmF0ZSBjaGlsZElkc0J5U2NvcmVJZChzY29yZTogaVNjb3JlKSB7XHJcbiAgICAgICAgbGV0IGluZGV4SWQgPSBzY29yZS5wYXJlbnRTY29yZUlkO1xyXG4gICAgICAgIGxldCBpZCA9IHNjb3JlLmlkO1xyXG4gICAgICAgIGlmIChpbmRleElkKSB7XHJcbiAgICAgICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLmNoaWxkSWRzQnlTY29yZUlkW2luZGV4SWRdO1xyXG4gICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yc0RhdGEuY2hpbGRJZHNCeVNjb3JlSWRbaW5kZXhJZF0gPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChpZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=