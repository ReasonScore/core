"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepositoryLocalReactive = void 0;

var _RsData = require("../dataModels/RsData");

var _RepositoryLocalBase = require("./RepositoryLocalBase");

class RepositoryLocalReactive extends _RepositoryLocalBase.RepositoryLocalBase {
  constructor(rsData = new _RsData.RsData()) {
    super(rsData);
    this.rsData = rsData;
  }

  notify(actions) {
    this.rsData.actionsLog.push(actions);

    for (const action of actions) {
      // "add_claim" |
      if (action.type == "add_claim" || action.type == "modify_claim") {
        this.rsData.claims[action.dataId] = action.newData;
      }

      if (action.type == "delete_claim") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_claimEdge" || action.type == "modify_claimEdge") {
        this.rsData.claimEdges[action.dataId] = action.newData;
        const item = action.newData;
        this.indexClaimEdgeIdByParentId(item);
        this.indexClaimEdgeIdByChildId(item);
      }

      if (action.type == "delete_claimEdge") {
        throw new Error("Method not implemented.");
      }

      if (action.type == "add_score" || action.type == "modify_score") {
        const item = action.newData;
        this.rsData.scores[action.dataId] = action.newData;
        this.scoreIdsBySourceId(item);
        this.childIdsByScoreId(item);
      }

      if (action.type == "delete_score") {
        throw new Error("Method not implemented.");
      }
    }
  }

  indexClaimEdgeIdByParentId(claimEdge) {
    let indexId = claimEdge.parentId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByParentId[claimEdge.parentId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByParentId[claimEdge.parentId] = destination;
    }

    if (!destination.includes(claimEdge.id)) {
      destination.push(claimEdge.id);
    }
  }

  indexClaimEdgeIdByChildId(claimEdge) {
    let indexId = claimEdge.childId;
    let id = claimEdge.id;
    let destination = this.rsData.claimEdgeIdsByChildId[indexId];

    if (!destination) {
      destination = [];
      this.rsData.claimEdgeIdsByChildId[indexId] = destination;
    }

    if (!destination.includes(id)) {
      destination.push(id);
    }
  }

  scoreIdsBySourceId(score) {
    //Source Claim ID
    {
      let indexId = score.sourceClaimId;
      let id = score.id;
      let destination = this.rsData.scoreIdsBySourceId[indexId];

      if (!destination) {
        destination = [];
        this.rsData.scoreIdsBySourceId[indexId] = destination;
      }

      if (!destination.includes(id)) {
        destination.push(id);
      }
    } //Source Edge ID

    if (score.sourceEdgeId) {
      let indexId = score.sourceEdgeId;
      let id = score.id;
      let destination = this.rsData.scoreIdsBySourceId[indexId];

      if (!destination) {
        destination = [];
        this.rsData.scoreIdsBySourceId[indexId] = destination;
      }

      if (!destination.includes(id)) {
        destination.push(id);
      }
    }
  } //TODO: not sure if this is correct


  childIdsByScoreId(score) {
    let indexId = score.parentScoreId;
    let id = score.id;

    if (indexId) {
      let destination = this.rsData.childIdsByScoreId[indexId];

      if (!destination) {
        destination = [];
        this.rsData.childIdsByScoreId[indexId] = destination;
      }

      if (!destination.includes(id)) {
        destination.push(id);
      }
    }
  }

}

exports.RepositoryLocalReactive = RepositoryLocalReactive;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZXBvc2l0b3JpZXMvUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUudHMiXSwibmFtZXMiOlsiUmVwb3NpdG9yeUxvY2FsUmVhY3RpdmUiLCJSZXBvc2l0b3J5TG9jYWxCYXNlIiwiY29uc3RydWN0b3IiLCJyc0RhdGEiLCJSc0RhdGEiLCJub3RpZnkiLCJhY3Rpb25zIiwiYWN0aW9uc0xvZyIsInB1c2giLCJhY3Rpb24iLCJ0eXBlIiwiY2xhaW1zIiwiZGF0YUlkIiwibmV3RGF0YSIsIkVycm9yIiwiY2xhaW1FZGdlcyIsIml0ZW0iLCJpbmRleENsYWltRWRnZUlkQnlQYXJlbnRJZCIsImluZGV4Q2xhaW1FZGdlSWRCeUNoaWxkSWQiLCJzY29yZXMiLCJzY29yZUlkc0J5U291cmNlSWQiLCJjaGlsZElkc0J5U2NvcmVJZCIsImNsYWltRWRnZSIsImluZGV4SWQiLCJwYXJlbnRJZCIsImlkIiwiZGVzdGluYXRpb24iLCJjbGFpbUVkZ2VJZHNCeVBhcmVudElkIiwiaW5jbHVkZXMiLCJjaGlsZElkIiwiY2xhaW1FZGdlSWRzQnlDaGlsZElkIiwic2NvcmUiLCJzb3VyY2VDbGFpbUlkIiwic291cmNlRWRnZUlkIiwicGFyZW50U2NvcmVJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUVBOztBQUlBOztBQUlPLE1BQU1BLHVCQUFOLFNBQXNDQyx3Q0FBdEMsQ0FBaUY7QUFFcEZDLEVBQUFBLFdBQVcsQ0FDQUMsTUFBZSxHQUFHLElBQUlDLGNBQUosRUFEbEIsRUFFVDtBQUNFLFVBQU1ELE1BQU47QUFERixTQURTQSxNQUNULEdBRFNBLE1BQ1Q7QUFFRDs7QUFFREUsRUFBQUEsTUFBTSxDQUFDQyxPQUFELEVBQTJCO0FBQzdCLFNBQUtILE1BQUwsQ0FBWUksVUFBWixDQUF1QkMsSUFBdkIsQ0FBNEJGLE9BQTVCOztBQUNBLFNBQUssTUFBTUcsTUFBWCxJQUFxQkgsT0FBckIsRUFBOEI7QUFDMUI7QUFDQSxVQUFJRyxNQUFNLENBQUNDLElBQVAsSUFB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QUFDRyxhQUFwQjtBQUNBLFFBQUlULEVBQUUsR0FBR00sS0FBSyxDQUFDTixFQUFmOztBQUNBLFFBQUlGLE9BQUosRUFBYTtBQUNULFVBQUlHLFdBQVcsR0FBRyxLQUFLdkIsTUFBTCxDQUFZa0IsaUJBQVosQ0FBOEJFLE9BQTlCLENBQWxCOztBQUNBLFVBQUksQ0FBQ0csV0FBTCxFQUFrQjtBQUNkQSxRQUFBQSxXQUFXLEdBQUcsRUFBZDtBQUNBLGFBQUt2QixNQUFMLENBQVlrQixpQkFBWixDQUE4QkUsT0FBOUIsSUFBeUNHLFdBQXpDO0FBQ0g7O0FBQ0QsVUFBSSxDQUFDQSxXQUFXLENBQUNFLFFBQVosQ0FBcUJILEVBQXJCLENBQUwsRUFBK0I7QUFDM0JDLFFBQUFBLFdBQVcsQ0FBQ2xCLElBQVosQ0FBaUJpQixFQUFqQjtBQUNIO0FBQ0o7QUFDSjs7QUFoSG1GIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaUNsYWltRWRnZSwgQ2xhaW1FZGdlIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1FZGdlXCI7XHJcbmltcG9ydCB7IGlTY29yZSwgU2NvcmUgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9TY29yZVwiO1xyXG5pbXBvcnQgeyBSc0RhdGEsIGlSc0RhdGEgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9Sc0RhdGFcIjtcclxuaW1wb3J0IHsgaVJlcG9zaXRvcnkgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9pUmVwb3NpdG9yeVwiO1xyXG5pbXBvcnQgeyBpQWN0aW9uLCBBY3Rpb24gfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9BY3Rpb25cIjtcclxuaW1wb3J0IHsgaUNsYWltIH0gZnJvbSBcIi4uL2RhdGFNb2RlbHMvQ2xhaW1cIjtcclxuaW1wb3J0IHsgUmVwb3NpdG9yeUxvY2FsQmFzZSB9IGZyb20gXCIuL1JlcG9zaXRvcnlMb2NhbEJhc2VcIjtcclxuaW1wb3J0IHsgQWN0aW9uVHlwZXMgfSBmcm9tIFwiLi4vZGF0YU1vZGVscy9BY3Rpb25UeXBlc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5TG9jYWxSZWFjdGl2ZSBleHRlbmRzIFJlcG9zaXRvcnlMb2NhbEJhc2UgaW1wbGVtZW50cyBpUmVwb3NpdG9yeSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIHJzRGF0YTogaVJzRGF0YSA9IG5ldyBSc0RhdGEoKVxyXG4gICAgKSB7XHJcbiAgICAgICAgc3VwZXIocnNEYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICBub3RpZnkoYWN0aW9uczogaUFjdGlvbltdKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yc0RhdGEuYWN0aW9uc0xvZy5wdXNoKGFjdGlvbnMpO1xyXG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcclxuICAgICAgICAgICAgLy8gXCJhZGRfY2xhaW1cIiB8XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImFkZF9jbGFpbVwiIHx8XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24udHlwZSA9PSBcIm1vZGlmeV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbXNbYWN0aW9uLmRhdGFJZF0gPSBhY3Rpb24ubmV3RGF0YVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT0gXCJhZGRfY2xhaW1FZGdlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X2NsYWltRWRnZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VzW2FjdGlvbi5kYXRhSWRdID0gYWN0aW9uLm5ld0RhdGFcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBDbGFpbUVkZ2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4Q2xhaW1FZGdlSWRCeVBhcmVudElkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmRleENsYWltRWRnZUlkQnlDaGlsZElkKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24udHlwZSA9PSBcImRlbGV0ZV9jbGFpbUVkZ2VcIikge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09IFwiYWRkX3Njb3JlXCIgfHxcclxuICAgICAgICAgICAgICAgIGFjdGlvbi50eXBlID09IFwibW9kaWZ5X3Njb3JlXCIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBhY3Rpb24ubmV3RGF0YSBhcyBTY29yZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnNEYXRhLnNjb3Jlc1thY3Rpb24uZGF0YUlkXSA9IGFjdGlvbi5uZXdEYXRhXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3JlSWRzQnlTb3VyY2VJZChpdGVtKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRJZHNCeVNjb3JlSWQoaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09IFwiZGVsZXRlX3Njb3JlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5kZXhDbGFpbUVkZ2VJZEJ5UGFyZW50SWQoY2xhaW1FZGdlOiBDbGFpbUVkZ2UpIHtcclxuICAgICAgICBsZXQgaW5kZXhJZCA9IGNsYWltRWRnZS5wYXJlbnRJZDtcclxuICAgICAgICBsZXQgaWQgPSBjbGFpbUVkZ2UuaWRcclxuICAgICAgICBsZXQgZGVzdGluYXRpb24gPSB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VJZHNCeVBhcmVudElkW2NsYWltRWRnZS5wYXJlbnRJZF07XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VJZHNCeVBhcmVudElkW2NsYWltRWRnZS5wYXJlbnRJZF0gPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbi5pbmNsdWRlcyhjbGFpbUVkZ2UuaWQpKSB7XHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uLnB1c2goY2xhaW1FZGdlLmlkKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluZGV4Q2xhaW1FZGdlSWRCeUNoaWxkSWQoY2xhaW1FZGdlOiBDbGFpbUVkZ2UpIHtcclxuICAgICAgICBsZXQgaW5kZXhJZCA9IGNsYWltRWRnZS5jaGlsZElkO1xyXG4gICAgICAgIGxldCBpZCA9IGNsYWltRWRnZS5pZDtcclxuICAgICAgICBsZXQgZGVzdGluYXRpb24gPSB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VJZHNCeUNoaWxkSWRbaW5kZXhJZF07XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICBkZXN0aW5hdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnJzRGF0YS5jbGFpbUVkZ2VJZHNCeUNoaWxkSWRbaW5kZXhJZF0gPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFkZXN0aW5hdGlvbi5pbmNsdWRlcyhpZCkpIHtcclxuICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChpZClcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzY29yZUlkc0J5U291cmNlSWQoc2NvcmU6IGlTY29yZSkge1xyXG4gICAgICAgIC8vU291cmNlIENsYWltIElEXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgaW5kZXhJZCA9IHNjb3JlLnNvdXJjZUNsYWltSWQ7XHJcbiAgICAgICAgICAgIGxldCBpZCA9IHNjb3JlLmlkO1xyXG4gICAgICAgICAgICBsZXQgZGVzdGluYXRpb24gPSB0aGlzLnJzRGF0YS5zY29yZUlkc0J5U291cmNlSWRbaW5kZXhJZF07XHJcbiAgICAgICAgICAgIGlmICghZGVzdGluYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5zY29yZUlkc0J5U291cmNlSWRbaW5kZXhJZF0gPSBkZXN0aW5hdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9uLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24ucHVzaChpZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9Tb3VyY2UgRWRnZSBJRFxyXG4gICAgICAgIGlmIChzY29yZS5zb3VyY2VFZGdlSWQpe1xyXG4gICAgICAgICAgICBsZXQgaW5kZXhJZCA9IHNjb3JlLnNvdXJjZUVkZ2VJZDtcclxuICAgICAgICAgICAgbGV0IGlkID0gc2NvcmUuaWQ7XHJcbiAgICAgICAgICAgIGxldCBkZXN0aW5hdGlvbiA9IHRoaXMucnNEYXRhLnNjb3JlSWRzQnlTb3VyY2VJZFtpbmRleElkXTtcclxuICAgICAgICAgICAgaWYgKCFkZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24gPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnNEYXRhLnNjb3JlSWRzQnlTb3VyY2VJZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghZGVzdGluYXRpb24uaW5jbHVkZXMoaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vVE9ETzogbm90IHN1cmUgaWYgdGhpcyBpcyBjb3JyZWN0XHJcbiAgICBwcml2YXRlIGNoaWxkSWRzQnlTY29yZUlkKHNjb3JlOiBpU2NvcmUpIHtcclxuICAgICAgICBsZXQgaW5kZXhJZCA9IHNjb3JlLnBhcmVudFNjb3JlSWQ7XHJcbiAgICAgICAgbGV0IGlkID0gc2NvcmUuaWQ7XHJcbiAgICAgICAgaWYgKGluZGV4SWQpIHtcclxuICAgICAgICAgICAgbGV0IGRlc3RpbmF0aW9uID0gdGhpcy5yc0RhdGEuY2hpbGRJZHNCeVNjb3JlSWRbaW5kZXhJZF07XHJcbiAgICAgICAgICAgIGlmICghZGVzdGluYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJzRGF0YS5jaGlsZElkc0J5U2NvcmVJZFtpbmRleElkXSA9IGRlc3RpbmF0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghZGVzdGluYXRpb24uaW5jbHVkZXMoaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbi5wdXNoKGlkKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSJdfQ==