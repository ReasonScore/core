"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateScore = calculateScore;

/**
 * Calculates a new score based on the child scores passed in.
 */
function calculateScore({
  childScores = [],
  reversible = true
} = {}) {
  // TODO: Simplify all this math and maybe break it up between base functionality and additional scoring (like the points)
  const newScore = {};
  newScore.confidence = 0;
  newScore.relevance = 1;
  newScore.childrenAveragingWeight = 0;
  newScore.childrenConfidenceWeight = 0;
  newScore.childrenRelevanceWeight = 0;
  newScore.childrenWeight = 0; // newScore.childrenProWeight = 0;
  // newScore.childrenConWeight = 0;

  if (childScores.filter(s => s.affects === 'confidence').length < 1) {
    // Defaults if there are no children
    newScore.confidence = 1; // assume 100% confident

    newScore.relevance = 1; // assume 100% relevant

    newScore.childrenAveragingWeight = 1;
    newScore.childrenConfidenceWeight = 1;
    newScore.childrenRelevanceWeight = 1;
    newScore.childrenWeight = 1;
  } //Gather children Weights totals for processing further down


  for (const childScore of childScores) {
    //Ensure calculations for non-reversible scores don't allow the confidence to be below 0
    //TODO: Is this needed in the totals seciton?
    let confidence = childScore.confidence;

    if (!childScore.reversible && childScore.confidence < 0) {
      confidence = 0;
    }

    childScore.weight = Math.abs(confidence) * childScore.relevance; // confidenceWeight * RelevanceWeight

    newScore.childrenAveragingWeight += 1;
    newScore.childrenConfidenceWeight += Math.abs(confidence);
    newScore.childrenRelevanceWeight += childScore.relevance;
    newScore.childrenWeight += childScore.weight; // //TODO: Experimantal
    // if (confidence > 0) {
    //     if (childScore.pro) {
    //         newScore.childrenProWeight += confidence
    //     }
    //     if (!childScore.pro) {
    //         newScore.childrenConWeight += confidence
    //     }
    // } else if (confidence < 0) {
    //     if (childScore.pro) {
    //         newScore.childrenConWeight += confidence
    //     }
    //     if (!childScore.pro) {
    //         newScore.childrenProWeight += confidence
    //     }
    // }
  } // Loop through to calculate the final scores


  for (const childScore of childScores) {
    const polarity = childScore.pro ? 1 : -1;

    if (childScore.affects === "confidence") {
      if (newScore.childrenWeight === 0) {
        childScore.percentOfWeight = 0;
        newScore.confidence = 0;
      } else {
        childScore.percentOfWeight = childScore.weight / // @ts-ignore
        newScore.childrenWeight; // @ts-ignore

        newScore.confidence += childScore.percentOfWeight * childScore.confidence * polarity;
      }
    }

    if (childScore.affects === "relevance") {
      // Process Relevance child claims
      let confidence = childScore.confidence;

      if (!childScore.reversible && childScore.confidence < 0) {
        confidence = 0;
      }

      if (newScore.relevance == undefined) {
        newScore.relevance = 1;
      }

      if (childScore.pro) {
        newScore.relevance += confidence;
      } else {
        newScore.relevance -= confidence / 2;
      }
    }

    let confidence = childScore.confidence;

    if (!childScore.reversible && childScore.confidence < 0) {
      confidence = 0;
    } // if (childScore.pro) {
    //     childScore.percentAgreeWeight = confidence / newScore.childrenProWeight
    // } else {
    //     childScore.percentAgreeWeight = confidence / newScore.childrenConWeight
    // }

  }

  if (Object.is(newScore.confidence, -0)) {
    // Protect against negative zero 
    newScore.confidence = 0;
  }

  return newScore;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jYWxjdWxhdGVTY29yZS50cyJdLCJuYW1lcyI6WyJjYWxjdWxhdGVTY29yZSIsImNoaWxkU2NvcmVzIiwicmV2ZXJzaWJsZSIsIm5ld1Njb3JlIiwiY29uZmlkZW5jZSIsInJlbGV2YW5jZSIsImNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0IiwiY2hpbGRyZW5Db25maWRlbmNlV2VpZ2h0IiwiY2hpbGRyZW5SZWxldmFuY2VXZWlnaHQiLCJjaGlsZHJlbldlaWdodCIsImZpbHRlciIsInMiLCJhZmZlY3RzIiwibGVuZ3RoIiwiY2hpbGRTY29yZSIsIndlaWdodCIsIk1hdGgiLCJhYnMiLCJwb2xhcml0eSIsInBybyIsInBlcmNlbnRPZldlaWdodCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImlzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBU0E7OztBQUdPLFNBQVNBLGNBQVQsQ0FBd0I7QUFBRUMsRUFBQUEsV0FBVyxHQUFHLEVBQWhCO0FBQW9CQyxFQUFBQSxVQUFVLEdBQUc7QUFBakMsSUFLM0IsRUFMRyxFQU1XO0FBQ2Q7QUFDQSxRQUFNQyxRQUF3QixHQUFHLEVBQWpDO0FBQ0FBLEVBQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixDQUF0QjtBQUNBRCxFQUFBQSxRQUFRLENBQUNFLFNBQVQsR0FBcUIsQ0FBckI7QUFDQUYsRUFBQUEsUUFBUSxDQUFDRyx1QkFBVCxHQUFtQyxDQUFuQztBQUNBSCxFQUFBQSxRQUFRLENBQUNJLHdCQUFULEdBQW9DLENBQXBDO0FBQ0FKLEVBQUFBLFFBQVEsQ0FBQ0ssdUJBQVQsR0FBbUMsQ0FBbkM7QUFDQUwsRUFBQUEsUUFBUSxDQUFDTSxjQUFULEdBQTBCLENBQTFCLENBUmMsQ0FTZDtBQUNBOztBQUdBLE1BQUlSLFdBQVcsQ0FBQ1MsTUFBWixDQUFtQkMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLE9BQUYsS0FBYyxZQUF0QyxFQUFvREMsTUFBcEQsR0FBNkQsQ0FBakUsRUFBb0U7QUFDaEU7QUFDQVYsSUFBQUEs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c0JELFVBQVUsR0FBRyxDQUFuQztBQUNIO0FBQ0o7O0FBRUQsUUFBSUEsVUFBVSxHQUFHVSxVQUFVLENBQUNWLFVBQTVCOztBQUNBLFFBQUksQ0FBQ1UsVUFBVSxDQUFDWixVQUFaLElBQTBCWSxVQUFVLENBQUNWLFVBQVgsR0FBd0IsQ0FBdEQsRUFBeUQ7QUFDckRBLE1BQUFBLFVBQVUsR0FBRyxDQUFiO0FBQ0gsS0EzQ2lDLENBNENsQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNIOztBQUdELE1BQUlrQixNQUFNLENBQUNDLEVBQVAsQ0FBVXBCLFFBQVEsQ0FBQ0MsVUFBbkIsRUFBK0IsQ0FBQyxDQUFoQyxDQUFKLEVBQXdDO0FBQ3BDO0FBQ0FELElBQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixDQUF0QjtBQUNIOztBQUVELFNBQU9ELFFBQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNjb3JlIH0gZnJvbSBcIi4vZGF0YU1vZGVscy9TY29yZVwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBpQ2FsY3VsYXRlU2NvcmUge1xyXG4gICAgKHsgY2hpbGRTY29yZXMgfToge1xyXG4gICAgICAgIC8qKiBBbiBhcnJheSBvZiBncm91cGVkIGVkZ2VzIGFuZCBjbGFpbXMqL1xyXG4gICAgICAgIGNoaWxkU2NvcmVzPzogU2NvcmVbXTtcclxuICAgIH0pOiBQYXJ0aWFsPFNjb3JlPlxyXG59XHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlcyBhIG5ldyBzY29yZSBiYXNlZCBvbiB0aGUgY2hpbGQgc2NvcmVzIHBhc3NlZCBpbi5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVTY29yZSh7IGNoaWxkU2NvcmVzID0gW10sIHJldmVyc2libGUgPSB0cnVlIH06IHtcclxuICAgIC8qKiBBbiBhcnJheSBvZiBncm91cGVkIGVkZ2VzIGFuZCBjbGFpbXMqL1xyXG4gICAgY2hpbGRTY29yZXM/OiBTY29yZVtdO1xyXG4gICAgLyoqIENhbiB0aGlzIHNjb3JlIGZhbGwgYmVsb3cgYSAwIGNvbmZpZGVuY2UgKGhhdmUgYSBuZWdhdGl2ZSBjb25maWRlbmNlKSAqL1xyXG4gICAgcmV2ZXJzaWJsZT86IGJvb2xlYW5cclxufSA9IHt9LFxyXG4pOiBQYXJ0aWFsPFNjb3JlPiB7XHJcbiAgICAvLyBUT0RPOiBTaW1wbGlmeSBhbGwgdGhpcyBtYXRoIGFuZCBtYXliZSBicmVhayBpdCB1cCBiZXR3ZWVuIGJhc2UgZnVuY3Rpb25hbGl0eSBhbmQgYWRkaXRpb25hbCBzY29yaW5nIChsaWtlIHRoZSBwb2ludHMpXHJcbiAgICBjb25zdCBuZXdTY29yZTogUGFydGlhbDxTY29yZT4gPSB7fTtcclxuICAgIG5ld1Njb3JlLmNvbmZpZGVuY2UgPSAwO1xyXG4gICAgbmV3U2NvcmUucmVsZXZhbmNlID0gMTtcclxuICAgIG5ld1Njb3JlLmNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0ID0gMDtcclxuICAgIG5ld1Njb3JlLmNoaWxkcmVuQ29uZmlkZW5jZVdlaWdodCA9IDA7XHJcbiAgICBuZXdTY29yZS5jaGlsZHJlblJlbGV2YW5jZVdlaWdodCA9IDA7XHJcbiAgICBuZXdTY29yZS5jaGlsZHJlbldlaWdodCA9IDA7XHJcbiAgICAvLyBuZXdTY29yZS5jaGlsZHJlblByb1dlaWdodCA9IDA7XHJcbiAgICAvLyBuZXdTY29yZS5jaGlsZHJlbkNvbldlaWdodCA9IDA7XHJcblxyXG5cclxuICAgIGlmIChjaGlsZFNjb3Jlcy5maWx0ZXIocyA9PiBzLmFmZmVjdHMgPT09ICdjb25maWRlbmNlJykubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIC8vIERlZmF1bHRzIGlmIHRoZXJlIGFyZSBubyBjaGlsZHJlblxyXG4gICAgICAgIG5ld1Njb3JlLmNvbmZpZGVuY2UgPSAxOyAvLyBhc3N1bWUgMTAwJSBjb25maWRlbnRcclxuICAgICAgICBuZXdTY29yZS5yZWxldmFuY2UgPSAxOyAvLyBhc3N1bWUgMTAwJSByZWxldmFudFxyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0ID0gMTtcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlbkNvbmZpZGVuY2VXZWlnaHQgPSAxO1xyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuUmVsZXZhbmNlV2VpZ2h0ID0gMTtcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlbldlaWdodCA9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgLy9HYXRoZXIgY2hpbGRyZW4gV2VpZ2h0cyB0b3RhbHMgZm9yIHByb2Nlc3NpbmcgZnVydGhlciBkb3duXHJcbiAgICBmb3IgKGNvbnN0IGNoaWxkU2NvcmUgb2YgY2hpbGRTY29yZXMpIHtcclxuICAgICAgICAvL0Vuc3VyZSBjYWxjdWxhdGlvbnMgZm9yIG5vbi1yZXZlcnNpYmxlIHNjb3JlcyBkb24ndCBhbGxvdyB0aGUgY29uZmlkZW5jZSB0byBiZSBiZWxvdyAwXHJcbiAgICAgICAgLy9UT0RPOiBJcyB0aGlzIG5lZWRlZCBpbiB0aGUgdG90YWxzIHNlY2l0b24/XHJcbiAgICAgICAgbGV0IGNvbmZpZGVuY2UgPSBjaGlsZFNjb3JlLmNvbmZpZGVuY2VcclxuICAgICAgICBpZiAoIWNoaWxkU2NvcmUucmV2ZXJzaWJsZSAmJiBjaGlsZFNjb3JlLmNvbmZpZGVuY2UgPCAwKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZGVuY2UgPSAwXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjaGlsZFNjb3JlLndlaWdodCA9IE1hdGguYWJzKGNvbmZpZGVuY2UpICogY2hpbGRTY29yZS5yZWxldmFuY2U7IC8vIGNvbmZpZGVuY2VXZWlnaHQgKiBSZWxldmFuY2VXZWlnaHRcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlbkF2ZXJhZ2luZ1dlaWdodCArPSAxO1xyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQ29uZmlkZW5jZVdlaWdodCArPSBNYXRoLmFicyhjb25maWRlbmNlKTtcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlblJlbGV2YW5jZVdlaWdodCArPSBjaGlsZFNjb3JlLnJlbGV2YW5jZTtcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlbldlaWdodCArPSBjaGlsZFNjb3JlLndlaWdodDtcclxuXHJcbiAgICAgICAgLy8gLy9UT0RPOiBFeHBlcmltYW50YWxcclxuICAgICAgICAvLyBpZiAoY29uZmlkZW5jZSA+IDApIHtcclxuICAgICAgICAvLyAgICAgaWYgKGNoaWxkU2NvcmUucHJvKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBuZXdTY29yZS5jaGlsZHJlblByb1dlaWdodCArPSBjb25maWRlbmNlXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyAgICAgaWYgKCFjaGlsZFNjb3JlLnBybykge1xyXG4gICAgICAgIC8vICAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5Db25XZWlnaHQgKz0gY29uZmlkZW5jZVxyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfSBlbHNlIGlmIChjb25maWRlbmNlIDwgMCkge1xyXG4gICAgICAgIC8vICAgICBpZiAoY2hpbGRTY29yZS5wcm8pIHtcclxuICAgICAgICAvLyAgICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQ29uV2VpZ2h0ICs9IGNvbmZpZGVuY2VcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vICAgICBpZiAoIWNoaWxkU2NvcmUucHJvKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBuZXdTY29yZS5jaGlsZHJlblByb1dlaWdodCArPSBjb25maWRlbmNlXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9vcCB0aHJvdWdoIHRvIGNhbGN1bGF0ZSB0aGUgZmluYWwgc2NvcmVzXHJcbiAgICBmb3IgKGNvbnN0IGNoaWxkU2NvcmUgb2YgY2hpbGRTY29yZXMpIHtcclxuICAgICAgICBjb25zdCBwb2xhcml0eSA9IGNoaWxkU2NvcmUucHJvID8gMSA6IC0xXHJcblxyXG4gICAgICAgIGlmIChjaGlsZFNjb3JlLmFmZmVjdHMgPT09IFwiY29uZmlkZW5jZVwiKSB7XHJcbiAgICAgICAgICAgIGlmIChuZXdTY29yZS5jaGlsZHJlbldlaWdodCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRTY29yZS5wZXJjZW50T2ZXZWlnaHQgPSAwO1xyXG4gICAgICAgICAgICAgICAgbmV3U2NvcmUuY29uZmlkZW5jZSA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hpbGRTY29yZS5wZXJjZW50T2ZXZWlnaHQgPVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUud2VpZ2h0IC9cclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5XZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgbmV3U2NvcmUuY29uZmlkZW5jZSArPVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucGVyY2VudE9mV2VpZ2h0ICpcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZFNjb3JlLmNvbmZpZGVuY2UgKiBwb2xhcml0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoaWxkU2NvcmUuYWZmZWN0cyA9PT0gXCJyZWxldmFuY2VcIikge1xyXG4gICAgICAgICAgICAvLyBQcm9jZXNzIFJlbGV2YW5jZSBjaGlsZCBjbGFpbXNcclxuXHJcbiAgICAgICAgICAgIGxldCBjb25maWRlbmNlID0gY2hpbGRTY29yZS5jb25maWRlbmNlXHJcbiAgICAgICAgICAgIGlmICghY2hpbGRTY29yZS5yZXZlcnNpYmxlICYmIGNoaWxkU2NvcmUuY29uZmlkZW5jZSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZGVuY2UgPSAwXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChuZXdTY29yZS5yZWxldmFuY2UgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdTY29yZS5yZWxldmFuY2UgPSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY2hpbGRTY29yZS5wcm8pIHtcclxuICAgICAgICAgICAgICAgIG5ld1Njb3JlLnJlbGV2YW5jZSArPSBjb25maWRlbmNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbmV3U2NvcmUucmVsZXZhbmNlIC09IGNvbmZpZGVuY2UgLyAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgY29uZmlkZW5jZSA9IGNoaWxkU2NvcmUuY29uZmlkZW5jZVxyXG4gICAgICAgIGlmICghY2hpbGRTY29yZS5yZXZlcnNpYmxlICYmIGNoaWxkU2NvcmUuY29uZmlkZW5jZSA8IDApIHtcclxuICAgICAgICAgICAgY29uZmlkZW5jZSA9IDBcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgKGNoaWxkU2NvcmUucHJvKSB7XHJcbiAgICAgICAgLy8gICAgIGNoaWxkU2NvcmUucGVyY2VudEFncmVlV2VpZ2h0ID0gY29uZmlkZW5jZSAvIG5ld1Njb3JlLmNoaWxkcmVuUHJvV2VpZ2h0XHJcbiAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAvLyAgICAgY2hpbGRTY29yZS5wZXJjZW50QWdyZWVXZWlnaHQgPSBjb25maWRlbmNlIC8gbmV3U2NvcmUuY2hpbGRyZW5Db25XZWlnaHRcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGlmIChPYmplY3QuaXMobmV3U2NvcmUuY29uZmlkZW5jZSwgLTApKSB7XHJcbiAgICAgICAgLy8gUHJvdGVjdCBhZ2FpbnN0IG5lZ2F0aXZlIHplcm8gXHJcbiAgICAgICAgbmV3U2NvcmUuY29uZmlkZW5jZSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ld1Njb3JlO1xyXG59XHJcblxyXG4iXX0=