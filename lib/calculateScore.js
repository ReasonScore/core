"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateScore = calculateScore;

/**
 * Calculates a new score based on the child scores passed in.
 */
function calculateScore({
  childScores = [],
  reversible = true
} = {}) {
  // TODO: Simplify all this math and maybe break it up between base functionality and additional scoring (like the points)
  const newScore = {
    confidence: 0,
    relevance: 1,
    childrenAveragingWeight: 0,
    childrenConfidenceWeight: 0,
    childrenRelevanceWeight: 0,
    childrenWeight: 0,
    childrenPointsPro: 0,
    childrenPointsCon: 0
  };

  if (childScores.filter(s => s.affects === 'confidence').length < 1) {
    // Defaults if there are no children
    newScore.confidence = 1; // assume 100% confident

    newScore.relevance = 1; // assume 100% relevant

    newScore.childrenAveragingWeight = 1;
    newScore.childrenConfidenceWeight = 1;
    newScore.childrenRelevanceWeight = 1;
    newScore.childrenWeight = 1;
    newScore.childrenPointsPro = 1;
    newScore.childrenPointsCon = 0;
  } //Gather children Weights totals for processing further down


  for (const childScore of childScores) {
    //Ensure calculations for non-reversible scores don't allow the confidence to be below 0
    //TODO: Is this needed in the totals seciton?
    let confidence = childScore.confidence;

    if (!childScore.reversible && childScore.confidence < 0) {
      confidence = 0;
    }

    childScore.weight = Math.abs(confidence) * childScore.relevance; // confidenceWeight * RelevanceWeight
    // @ts-ignore

    newScore.childrenAveragingWeight += 1; // @ts-ignore

    newScore.childrenConfidenceWeight += Math.abs(confidence); // @ts-ignore

    newScore.childrenRelevanceWeight += childScore.relevance; // @ts-ignore

    newScore.childrenWeight += childScore.weight;
  } // Loop through to calculate the final scores


  for (const childScore of childScores) {
    const polarity = childScore.pro ? 1 : -1;

    if (childScore.affects === "confidence") {
      if (newScore.childrenWeight === 0) {
        childScore.percentOfWeight = 0;
        newScore.confidence = 0;
      } else {
        // @ts-ignore
        childScore.percentOfWeight = childScore.weight / // @ts-ignore
        newScore.childrenWeight; // @ts-ignore

        newScore.confidence += childScore.percentOfWeight * childScore.confidence * polarity;

        if (childScore.pro) {
          childScore.pointsPro = childScore.childrenPointsPro * childScore.percentOfWeight;
          childScore.pointsCon = childScore.childrenPointsCon * childScore.percentOfWeight;
        } else {
          childScore.pointsPro = childScore.childrenPointsCon * childScore.percentOfWeight;
          childScore.pointsCon = childScore.childrenPointsPro * childScore.percentOfWeight;
        } // @ts-ignore


        newScore.childrenPointsPro += childScore.pointsPro; // @ts-ignore

        newScore.childrenPointsCon += childScore.pointsCon;
      }
    }

    if (childScore.affects === "relevance") {
      // Process Relevance child claims
      let confidence = childScore.confidence;

      if (!childScore.reversible && childScore.confidence < 0) {
        confidence = 0;
      }

      if (newScore.relevance == undefined) {
        newScore.relevance = 1;
      }

      if (childScore.pro) {
        newScore.relevance += confidence;
      } else {
        newScore.relevance -= confidence / 2;
      }
    }
  }

  if (Object.is(newScore.confidence, -0)) {
    // Protect against negative zero 
    newScore.confidence = 0;
  }

  return newScore;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jYWxjdWxhdGVTY29yZS50cyJdLCJuYW1lcyI6WyJjYWxjdWxhdGVTY29yZSIsImNoaWxkU2NvcmVzIiwicmV2ZXJzaWJsZSIsIm5ld1Njb3JlIiwiY29uZmlkZW5jZSIsInJlbGV2YW5jZSIsImNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0IiwiY2hpbGRyZW5Db25maWRlbmNlV2VpZ2h0IiwiY2hpbGRyZW5SZWxldmFuY2VXZWlnaHQiLCJjaGlsZHJlbldlaWdodCIsImNoaWxkcmVuUG9pbnRzUHJvIiwiY2hpbGRyZW5Qb2ludHNDb24iLCJmaWx0ZXIiLCJzIiwiYWZmZWN0cyIsImxlbmd0aCIsImNoaWxkU2NvcmUiLCJ3ZWlnaHQiLCJNYXRoIiwiYWJzIiwicG9sYXJpdHkiLCJwcm8iLCJwZXJjZW50T2ZXZWlnaHQiLCJwb2ludHNQcm8iLCJwb2ludHNDb24iLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJpcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVNBOzs7QUFHTyxTQUFTQSxjQUFULENBQXdCO0FBQUVDLEVBQUFBLFdBQVcsR0FBRyxFQUFoQjtBQUFvQkMsRUFBQUEsVUFBVSxHQUFHO0FBQWpDLElBSzNCLEVBTEcsRUFNVztBQUNkO0FBQ0EsUUFBTUMsUUFBd0IsR0FBRztBQUM3QkMsSUFBQUEsVUFBVSxFQUFFLENBRGlCO0FBRTdCQyxJQUFBQSxTQUFTLEVBQUUsQ0FGa0I7QUFHN0JDLElBQUFBLHVCQUF1QixFQUFFLENBSEk7QUFJN0JDLElBQUFBLHdCQUF3QixFQUFFLENBSkc7QUFLN0JDLElBQUFBLHVCQUF1QixFQUFFLENBTEk7QUFNN0JDLElBQUFBLGNBQWMsRUFBRSxDQU5hO0FBTzdCQyxJQUFBQSxpQkFBaUIsRUFBRSxDQVBVO0FBUTdCQyxJQUFBQSxpQkFBaUIsRUFBRTtBQVJVLEdBQWpDOztBQVdBLE1BQUlWLFdBQVcsQ0FBQ1csTUFBWixDQUFtQkMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLE9BQUYsS0FBYyxZQUF0QyxFQUFvREMs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QUNNLGVBQWpFO0FBQ0gsU0FuQkUsQ0FxQkg7OztBQUNBbkIsUUFBQUEsUUFBUSxDQUFDTyxpQkFBVCxJQUNJTSxVQUFVLENBQUNPLFNBRGYsQ0F0QkcsQ0F3Qkg7O0FBQ0FwQixRQUFBQSxRQUFRLENBQUNRLGlCQUFULElBQ0lLLFVBQVUsQ0FBQ1EsU0FEZjtBQUVIO0FBQ0o7O0FBRUQsUUFBSVIsVUFBVSxDQUFDRixPQUFYLEtBQXVCLFdBQTNCLEVBQXdDO0FBQ3BDO0FBRUEsVUFBSVYsVUFBVSxHQUFHWSxVQUFVLENBQUNaLFVBQTVCOztBQUNBLFVBQUksQ0FBQ1ksVUFBVSxDQUFDZCxVQUFaLElBQTBCYyxVQUFVLENBQUNaLFVBQVgsR0FBd0IsQ0FBdEQsRUFBeUQ7QUFDckRBLFFBQUFBLFVBQVUsR0FBRyxDQUFiO0FBQ0g7O0FBRUQsVUFBSUQsUUFBUSxDQUFDRSxTQUFULElBQXNCb0IsU0FBMUIsRUFBcUM7QUFDakN0QixRQUFBQSxRQUFRLENBQUNFLFNBQVQsR0FBcUIsQ0FBckI7QUFDSDs7QUFFRCxVQUFJVyxVQUFVLENBQUNLLEdBQWYsRUFBb0I7QUFDaEJsQixRQUFBQSxRQUFRLENBQUNFLFNBQVQsSUFBc0JELFVBQXRCO0FBQ0gsT0FGRCxNQUVPO0FBQ0hELFFBQUFBLFFBQVEsQ0FBQ0UsU0FBVCxJQUFzQkQsVUFBVSxHQUFHLENBQW5DO0FBQ0g7QUFDSjtBQUNKOztBQUdELE1BQUlzQixNQUFNLENBQUNDLEVBQVAsQ0FBVXhCLFFBQVEsQ0FBQ0MsVUFBbkIsRUFBK0IsQ0FBQyxDQUFoQyxDQUFKLEVBQXdDO0FBQ3BDO0FBQ0FELElBQUFBLFFBQVEsQ0FBQ0MsVUFBVCxHQUFzQixDQUF0QjtBQUNIOztBQUVELFNBQU9ELFFBQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlTY29yZSwgaVNjb3JlRnJhZ21lbnQgfSBmcm9tIFwiLi9kYXRhTW9kZWxzL1Njb3JlXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIGlDYWxjdWxhdGVTY29yZSB7XHJcbiAgICAoeyBjaGlsZFNjb3JlcyB9OiB7XHJcbiAgICAgICAgLyoqIEFuIGFycmF5IG9mIGdyb3VwZWQgZWRnZXMgYW5kIGNsYWltcyovXHJcbiAgICAgICAgY2hpbGRTY29yZXM/OiBpU2NvcmVbXTtcclxuICAgIH0pOiBpU2NvcmVGcmFnbWVudFxyXG59XHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlcyBhIG5ldyBzY29yZSBiYXNlZCBvbiB0aGUgY2hpbGQgc2NvcmVzIHBhc3NlZCBpbi5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVTY29yZSh7IGNoaWxkU2NvcmVzID0gW10sIHJldmVyc2libGUgPSB0cnVlIH06IHtcclxuICAgIC8qKiBBbiBhcnJheSBvZiBncm91cGVkIGVkZ2VzIGFuZCBjbGFpbXMqL1xyXG4gICAgY2hpbGRTY29yZXM/OiBpU2NvcmVbXTtcclxuICAgIC8qKiBDYW4gdGhpcyBzY29yZSBmYWxsIGJlbG93IGEgMCBjb25maWRlbmNlIChoYXZlIGEgbmVnYXRpdmUgY29uZmlkZW5jZSkgKi9cclxuICAgIHJldmVyc2libGU/OiBib29sZWFuXHJcbn0gPSB7fSxcclxuKTogaVNjb3JlRnJhZ21lbnQge1xyXG4gICAgLy8gVE9ETzogU2ltcGxpZnkgYWxsIHRoaXMgbWF0aCBhbmQgbWF5YmUgYnJlYWsgaXQgdXAgYmV0d2VlbiBiYXNlIGZ1bmN0aW9uYWxpdHkgYW5kIGFkZGl0aW9uYWwgc2NvcmluZyAobGlrZSB0aGUgcG9pbnRzKVxyXG4gICAgY29uc3QgbmV3U2NvcmU6IGlTY29yZUZyYWdtZW50ID0ge1xyXG4gICAgICAgIGNvbmZpZGVuY2U6IDAsXHJcbiAgICAgICAgcmVsZXZhbmNlOiAxLFxyXG4gICAgICAgIGNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0OiAwLFxyXG4gICAgICAgIGNoaWxkcmVuQ29uZmlkZW5jZVdlaWdodDogMCxcclxuICAgICAgICBjaGlsZHJlblJlbGV2YW5jZVdlaWdodDogMCxcclxuICAgICAgICBjaGlsZHJlbldlaWdodDogMCxcclxuICAgICAgICBjaGlsZHJlblBvaW50c1BybzogMCxcclxuICAgICAgICBjaGlsZHJlblBvaW50c0NvbjogMCxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGNoaWxkU2NvcmVzLmZpbHRlcihzID0+IHMuYWZmZWN0cyA9PT0gJ2NvbmZpZGVuY2UnKS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgLy8gRGVmYXVsdHMgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuXHJcbiAgICAgICAgbmV3U2NvcmUuY29uZmlkZW5jZSA9IDE7IC8vIGFzc3VtZSAxMDAlIGNvbmZpZGVudFxyXG4gICAgICAgIG5ld1Njb3JlLnJlbGV2YW5jZSA9IDE7IC8vIGFzc3VtZSAxMDAlIHJlbGV2YW50XHJcbiAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5BdmVyYWdpbmdXZWlnaHQgPSAxO1xyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQ29uZmlkZW5jZVdlaWdodCA9IDE7XHJcbiAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5SZWxldmFuY2VXZWlnaHQgPSAxO1xyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuV2VpZ2h0ID0gMTtcclxuICAgICAgICBuZXdTY29yZS5jaGlsZHJlblBvaW50c1BybyA9IDE7XHJcbiAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5Qb2ludHNDb24gPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIC8vR2F0aGVyIGNoaWxkcmVuIFdlaWdodHMgdG90YWxzIGZvciBwcm9jZXNzaW5nIGZ1cnRoZXIgZG93blxyXG4gICAgZm9yIChjb25zdCBjaGlsZFNjb3JlIG9mIGNoaWxkU2NvcmVzKSB7XHJcbiAgICAgICAgLy9FbnN1cmUgY2FsY3VsYXRpb25zIGZvciBub24tcmV2ZXJzaWJsZSBzY29yZXMgZG9uJ3QgYWxsb3cgdGhlIGNvbmZpZGVuY2UgdG8gYmUgYmVsb3cgMFxyXG4gICAgICAgIC8vVE9ETzogSXMgdGhpcyBuZWVkZWQgaW4gdGhlIHRvdGFscyBzZWNpdG9uP1xyXG4gICAgICAgIGxldCBjb25maWRlbmNlID0gY2hpbGRTY29yZS5jb25maWRlbmNlXHJcbiAgICAgICAgaWYgKCFjaGlsZFNjb3JlLnJldmVyc2libGUgJiYgY2hpbGRTY29yZS5jb25maWRlbmNlIDwgMCkge1xyXG4gICAgICAgICAgICBjb25maWRlbmNlID0gMFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2hpbGRTY29yZS53ZWlnaHQgPSBNYXRoLmFicyhjb25maWRlbmNlKSAqIGNoaWxkU2NvcmUucmVsZXZhbmNlOyAvLyBjb25maWRlbmNlV2VpZ2h0ICogUmVsZXZhbmNlV2VpZ2h0XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQXZlcmFnaW5nV2VpZ2h0ICs9IDE7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuQ29uZmlkZW5jZVdlaWdodCArPVxyXG4gICAgICAgICAgICBNYXRoLmFicyhjb25maWRlbmNlKTtcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgbmV3U2NvcmUuY2hpbGRyZW5SZWxldmFuY2VXZWlnaHQgKz1cclxuICAgICAgICAgICAgY2hpbGRTY29yZS5yZWxldmFuY2U7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuV2VpZ2h0ICs9XHJcbiAgICAgICAgICAgIGNoaWxkU2NvcmUud2VpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCB0byBjYWxjdWxhdGUgdGhlIGZpbmFsIHNjb3Jlc1xyXG4gICAgZm9yIChjb25zdCBjaGlsZFNjb3JlIG9mIGNoaWxkU2NvcmVzKSB7XHJcbiAgICAgICAgY29uc3QgcG9sYXJpdHkgPSBjaGlsZFNjb3JlLnBybyA/IDEgOiAtMVxyXG5cclxuICAgICAgICBpZiAoY2hpbGRTY29yZS5hZmZlY3RzID09PSBcImNvbmZpZGVuY2VcIikge1xyXG4gICAgICAgICAgICBpZiAobmV3U2NvcmUuY2hpbGRyZW5XZWlnaHQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucGVyY2VudE9mV2VpZ2h0ID0gMDtcclxuICAgICAgICAgICAgICAgIG5ld1Njb3JlLmNvbmZpZGVuY2UgPSAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucGVyY2VudE9mV2VpZ2h0ID1cclxuICAgICAgICAgICAgICAgICAgICBjaGlsZFNjb3JlLndlaWdodCAvXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuV2VpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIG5ld1Njb3JlLmNvbmZpZGVuY2UgKz1cclxuICAgICAgICAgICAgICAgICAgICBjaGlsZFNjb3JlLnBlcmNlbnRPZldlaWdodCAqXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRTY29yZS5jb25maWRlbmNlICogcG9sYXJpdHk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkU2NvcmUucHJvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRTY29yZS5wb2ludHNQcm8gPSBjaGlsZFNjb3JlLmNoaWxkcmVuUG9pbnRzUHJvICogY2hpbGRTY29yZS5wZXJjZW50T2ZXZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRTY29yZS5wb2ludHNDb24gPSBjaGlsZFNjb3JlLmNoaWxkcmVuUG9pbnRzQ29uICogY2hpbGRTY29yZS5wZXJjZW50T2ZXZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucG9pbnRzUHJvID0gY2hpbGRTY29yZS5jaGlsZHJlblBvaW50c0NvbiAqIGNoaWxkU2NvcmUucGVyY2VudE9mV2VpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucG9pbnRzQ29uID0gY2hpbGRTY29yZS5jaGlsZHJlblBvaW50c1BybyAqIGNoaWxkU2NvcmUucGVyY2VudE9mV2VpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgIG5ld1Njb3JlLmNoaWxkcmVuUG9pbnRzUHJvICs9XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRTY29yZS5wb2ludHNQcm87XHJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICBuZXdTY29yZS5jaGlsZHJlblBvaW50c0NvbiArPVxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcmUucG9pbnRzQ29uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hpbGRTY29yZS5hZmZlY3RzID09PSBcInJlbGV2YW5jZVwiKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2Nlc3MgUmVsZXZhbmNlIGNoaWxkIGNsYWltc1xyXG5cclxuICAgICAgICAgICAgbGV0IGNvbmZpZGVuY2UgPSBjaGlsZFNjb3JlLmNvbmZpZGVuY2VcclxuICAgICAgICAgICAgaWYgKCFjaGlsZFNjb3JlLnJldmVyc2libGUgJiYgY2hpbGRTY29yZS5jb25maWRlbmNlIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgY29uZmlkZW5jZSA9IDBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG5ld1Njb3JlLnJlbGV2YW5jZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG5ld1Njb3JlLnJlbGV2YW5jZSA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjaGlsZFNjb3JlLnBybykge1xyXG4gICAgICAgICAgICAgICAgbmV3U2NvcmUucmVsZXZhbmNlICs9IGNvbmZpZGVuY2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBuZXdTY29yZS5yZWxldmFuY2UgLT0gY29uZmlkZW5jZSAvIDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGlmIChPYmplY3QuaXMobmV3U2NvcmUuY29uZmlkZW5jZSwgLTApKSB7XHJcbiAgICAgICAgLy8gUHJvdGVjdCBhZ2FpbnN0IG5lZ2F0aXZlIHplcm8gXHJcbiAgICAgICAgbmV3U2NvcmUuY29uZmlkZW5jZSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ld1Njb3JlO1xyXG59XHJcblxyXG4iXX0=